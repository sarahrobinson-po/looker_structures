{"elements": [{"Label": "AEBG", "Type": "model", "SQL": "no sql?"}, {"Label": "aebg_allocations", "Type": "view", "SQL": "(\n\nselect\naebg_inst.member_id,\naebg_inst.member_name,\nmember_a.amount as member_allocations,\naebg_inst.consortium_id,\naebg_inst.consortium_name,\nconsortium_a.amount as consortium_allocations,\naebg_inst.region_name,\nyears.name as 'year',\ncfads.direct_funding,\nstates.name as cfad_status\nfrom\n(\n\nselect\nmembers.id as member_id,\nmembers.name as member_name,\nmembers.`type` as member_type,\nconsortia.id as consortium_id,\nconsortia.name as consortium_name,\nconsortia.`type` as consortium_type,\nregions.id as region_id,\nregions.name as region_name,\nregions.`type` as region_type\n\n from proposals_funds pf\n join proposals_institutions ip on ip.proposal_id = pf.proposal_id and ip.is_lead = 1\n join proposals_institutions mp on mp.proposal_id = ip.proposal_id and mp.is_lead = 0\n join institutions_relationships ir on ir.institution_id = ip.institution_id\n join institutions regions on regions.id = ir.institution_parent_id\n join institutions consortia on consortia.id = ip.institution_id\n join institutions members on members.id = mp.institution_id\n\n where fund_id = 3\n)\nas aebg_inst\njoin years\n\njoin allocations member_a\non member_a.to_institution_id = aebg_inst.member_id\nand member_a.year_id = years.id\nand member_a.fund_id = 3\n\njoin allocations consortium_a\non consortium_a.to_institution_id = aebg_inst.consortium_id\nand years.id = consortium_a.year_id\nand consortium_a.fund_id = 3\n\njoin cfads\non cfads.institution_id = aebg_inst.consortium_id\nand cfads.year_id = years.id\n\njoin states\non states.id = cfads.status_id\n\n\n\n\n)"}, {"Label": "aebg_financial_reporting", "Type": "view", "SQL": "(\n\n\nselect\nconcat(fr_dt.id,'-', fr_dt.object_code_id) as unique_id,\naebg_institutions_dt.member_name,\naebg_institutions_dt.consortium_name,\naebg_institutions_dt.region_name,\nfr_dt.institution_id,\nyears.name as 'year',\nfr_dt.`quarter`,\nfr_dt.oc_name,\nfr_dt.amount as expenditure,\nbudget_items_dt.annual_budget,\nbudget_items_dt.quarterly_forecast,\na.amount as allocation,\ncfads.direct_funding\n\nfrom\n\n\n\n( select\n    fiscal_reports.id,\n    fiscal_reports.proposal_id,\n    fiscal_reports.duration_id,\n    fiscal_reports.institution_id,\n    fiscal_reports.fund_id,\n    durations.year_id,\n    durations.`quarter`,\n    fiscal_report_lines.amount,\n    object_codes.name as oc_name,\n    object_codes.id as object_code_id\n\n  from fiscal_reports\n  join fiscal_report_lines on fiscal_report_lines.fiscal_report_id = fiscal_reports.id\n  join object_codes on object_codes.id = fiscal_report_lines.object_code_id\n  join durations on durations.id = fiscal_reports.duration_id\n  where durations.`type` = 'quarter' and fiscal_reports.fund_id = 3\n\n\n) as fr_dt\njoin years on years.id = fr_dt.year_id\n\nleft join (\nselect budget_melt.id, budget_melt.object_code_id, budget_melt.proposal_id,\n    sum(budget_melt.amount) as annual_budget, budget_melt.budget_id, budget_melt.institution_id,\n    budget_melt.year_id, budget_melt.fund_id, budget_melt.quart, (budget_melt.percent * sum(budget_melt.amount))/100 as 'quarterly_forecast'\n    from\n    (\n      select id, object_code_id, proposal_id, amount, budget_id, institution_id, year_id, fund_id, '1' quart, quarter_1 percent\n      from budget_items\n      union all\n      select id, object_code_id, proposal_id, amount, budget_id, institution_id, year_id, fund_id, '2' quart, quarter_2 percent\n      from budget_items\n      union all\n      select id, object_code_id, proposal_id, amount, budget_id, institution_id, year_id, fund_id, '3' quart, quarter_3 percent\n      from budget_items\n      union all\n      select id, object_code_id, proposal_id, amount, budget_id, institution_id, year_id, fund_id, '4' quart, quarter_4 percent\n      from budget_items\n    ) as budget_melt\n\n\ngroup by proposal_id, institution_id, object_code_id, year_id, quart\n\n\n) as budget_items_dt on\n\n budget_items_dt.institution_id = fr_dt.institution_id\n  and budget_items_dt.year_id = years.id\n  and budget_items_dt.quart = fr_dt.`quarter`\n  and budget_items_dt.fund_id = fr_dt.fund_id\n  and budget_items_dt.object_code_id = fr_dt.object_code_id\n\njoin allocations a\non a.to_institution_id = fr_dt.institution_id\nand a.year_id = years.id\nand a.fund_id = 3\n\njoin (\n\nselect\nmembers.id as member_id,\nmembers.name as member_name,\nmembers.`type` as member_type,\nconsortia.id as consortium_id,\nconsortia.name as consortium_name,\nconsortia.`type` as consortium_type,\nregions.id as region_id,\nregions.name as region_name,\nregions.`type` as region_type\n\n from proposals_funds pf\n join proposals_institutions ip on ip.proposal_id = pf.proposal_id and ip.is_lead = 1\n join proposals_institutions mp on mp.proposal_id = ip.proposal_id and mp.is_lead = 0\n join institutions_relationships ir on ir.institution_id = ip.institution_id\n join institutions regions on regions.id = ir.institution_parent_id\n join institutions consortia on consortia.id = ip.institution_id\n join institutions members on members.id = mp.institution_id\n\n where fund_id = 3\n  group by mp.proposal_id, mp.institution_id\n) as aebg_institutions_dt\n\non aebg_institutions_dt.member_id = fr_dt.institution_id\njoin cfads on cfads.institution_id = aebg_institutions_dt.consortium_id\nand cfads.year_id = years.id\nwhere\n(fr_dt.amount !=0 or annual_budget is not null)\n\n\n\n\n)"}, {"Label": "caep", "Type": "explore", "SQL": "no sql?"}, {"Label": "all_allocations", "Type": "view", "SQL": "allocations"}, {"Label": "ALL_budget_object_codes", "Type": "view", "SQL": "(\n\n  SELECT\nbi.id,\nbi.object_code_id,\nbi.proposal_id,\nbi.institution_id,\nbi.fund_id,\nbi.year_id,\nbi.amount,\nbi.description,\noc.name\n\n\nFROM budget_items bi\nJOIN object_codes oc ON oc.id = bi.object_code_id\n\n\n  )"}, {"Label": "all_durations", "Type": "view", "SQL": "durations"}, {"Label": "all_fiscal_reports_lines", "Type": "view", "SQL": "(\n\nSELECT\nfr.id AS fiscal_report_id,\nip.id AS proposals_institutions_id,\nfr.proposal_id,\nfr.institution_id,\nfr.fund_id,\nfr.duration_id,\nfr.creator_id,\nfr.submitted,\nfr.require_explanation,\n\nfrl.id AS fiscal_report_lines_id,\nfrl.object_code_id,\nfrl.allocation_year_id,\nfrl.fund_id as frl_fund_id,\nfrl.amount\n\nFROM fiscal_reports fr\nJOIN proposals_institutions ip ON ip.institution_id = fr.institution_id\n  AND ip.proposal_id = fr.proposal_id\nleft JOIN fiscal_report_lines frl ON frl.fiscal_report_id = fr.id\n\nWHERE fr.deleted = 0\n\n)"}, {"Label": "all_institutions_dt", "Type": "view", "SQL": "swp_institutions_dt"}, {"Label": "all_lead_institution", "Type": "view", "SQL": "(\n\n    SELECT\n\n  lead_agency_id.institution_id,\n  lead_agency_id.proposal_id,\n\n  lead_agency_lineage.name as lead_agency,\n  lead_agency_lineage.type as lead_agency_type,\n  lead_agency_lineage.district as lead_agency_district,\n  lead_agency_lineage.region as lead_agency_region,\n  pf.fund_id\n\n\nFROM proposals_institutions lead_agency_id\nJOIN proposals_funds pf ON lead_agency_id.proposal_id = pf.proposal_id AND lead_agency_id.is_lead = 1\n\nLEFT JOIN swp_institutions_dt lead_agency_lineage\n  ON lead_agency_lineage.id = lead_agency_id.institution_id AND lead_agency_id.is_lead = 1\n\n  )"}, {"Label": "all_project_lead", "Type": "view", "SQL": "(\n\nSELECT\nproject_lead.fund_id,\nproject_lead.proposal_id,\nproject_lead.institution_id,\nCONCAT( project_lead_contact.last_name, ', ',\nproject_lead_contact.first_name) AS contact_name,\n\nproject_lead_contact.title,\nproject_lead_contact.email_address,\nproject_lead_contact.phone\n\n#getting lead agency contact information\nfrom users_role_scopes project_lead\n\nLEFT JOIN users project_lead_contact        # joining users to get the contact name\n  ON project_lead_contact.id = project_lead.user_id\n\nWHERE project_lead.role_id = 23\n\n  )"}, {"Label": "all_proposals", "Type": "view", "SQL": "proposals"}, {"Label": "ALL_proposals_institutions_names_funds", "Type": "view", "SQL": "dw_proposals_institutions_funds"}, {"Label": "all_resource_notes", "Type": "view", "SQL": "(SELECT\nr.id,\nr.user_id,\nr.fund_id,\nr.proposal_id,\nr.institution_id,\nr.area_name,\nrn.score,\nrn.comment,\nrn.`type`\nFROM resources r\nJOIN resource_notes rn ON rn.resource_id = r.id\nWHERE rn.score IS NOT NULL )"}, {"Label": "all_role_scopes", "Type": "view", "SQL": "(\nSELECT\nurs.*\nFROM users_role_scopes urs\nLEFT JOIN proposals p ON p.id = urs.proposal_id\nWHERE (p.deleted = 0 OR urs.proposal_id IS NULL)\n  )"}, {"Label": "all_users", "Type": "view", "SQL": "users"}, {"Label": "all_years", "Type": "view", "SQL": "years"}, {"Label": "budgets_unpivoted", "Type": "view", "SQL": "(\n\nSELECT\nip.id AS proposals_institutions_id,\ndt.*\n\n\nFROM budgets_unpivoted dt\nJOIN proposals_institutions ip ON ip.institution_id = dt.institution_id\n  AND ip.proposal_id = dt.proposal_id\n\n  )"}, {"Label": "caep_annual_plan_status", "Type": "view", "SQL": "(\n\nSELECT\nap.id,\nap.institution_id,\nap.year_id,\nap.status_id,\nap.proposal_id,\n(case when ap.status_id IS NULL then 'N/A'\nELSE s.name END) AS annual_plan_status\nFROM annual_plans  ap\nJOIN proposals_funds pf ON pf.proposal_id = ap.proposal_id AND pf.fund_id = 3\nLEFT JOIN states s ON s.id = ap.status_id\n\n\n\n\n)"}, {"Label": "caep_cfads", "Type": "view", "SQL": "cfads"}, {"Label": "caep_institutions_dt", "Type": "view", "SQL": "(SELECT\n  mp.id AS member_proposal_id,\npf.proposal_id,\nmp.year_id,\nmembers.id as member_id,\nmembers.name as member_name,\nmembers.`type` as member_type,\nconsortia.id as consortium_id,\nconsortia.name as consortium_name,\nconsortia.`type` as consortium_type,\nregions.id as region_id,\nregions.name as region_name,\nregions.`type` as region_type\n\n from proposals_funds pf\n join proposals_institutions ip on ip.proposal_id = pf.proposal_id and ip.is_lead = 1\n join proposals_institutions mp on mp.proposal_id = ip.proposal_id and mp.is_lead = 0\n join institutions_relationships ir on ir.institution_id = ip.institution_id\n join institutions regions on regions.id = ir.institution_parent_id\n join institutions consortia on consortia.id = ip.institution_id\n join institutions members on members.id = mp.institution_id\n\n where fund_id = 3   )"}, {"Label": "caep_program_area_reports", "Type": "view", "SQL": "(\n\n  SELECT\npar.id as program_area_report_id,\n\nip.id AS proposals_institutions_id,\npar.proposal_id,\npar.institution_id,\npar.year_id,\npar.state_id,\n\ns.NAME AS report_status\n\n\nFROM program_area_reports par\nJOIN proposals_institutions ip ON ip.institution_id = par.institution_id\n  AND ip.proposal_id = par.proposal_id\n  AND ip.year_id = par.year_id\n\n\nLEFT JOIN states s ON s.id = par.state_id\n\n\n  )"}, {"Label": "caep_program_area_report_lines", "Type": "view", "SQL": "(\n\nSELECT\n\nparl.program_area_report_id,\nparl.id AS program_area_report_lines_id,\n\n\nparl.fund_id,\n\nf.NAME AS fund,\npa.NAME AS program_area,\nparl.`type`,\nparl.amount\nFROM program_area_report_lines parl\nLEFT JOIN funds f ON f.id = parl.fund_id\nJOIN program_areas pa ON pa.id = parl.program_area_id\n\n\n)"}, {"Label": "caep_strategies", "Type": "view", "SQL": "(\n  SELECT\n  ip.id AS proposals_institutions_id,\n  wp_items.year_id,\n\n  wp_items.id as workplan_id,\n  wp_items.proposal_id,\n  wp_strat.annual_plan_strategy_id,\n  wp_inst.institution_id,\n  ap_strat.objective,\n\n  ap_strat.description,\n  ap_strat.annual_plan_id\nfrom workplan_items wp_items\n\njoin workplan_items_strategies wp_strat\n  on wp_strat.workplan_item_id = wp_items.id\njoin workplan_items_institutions wp_inst\n  on wp_inst.workplan_item_id = wp_items.id\njoin annual_plan_strategies ap_strat\n  on ap_strat.id = wp_strat.annual_plan_strategy_id\nJOIN proposals_institutions ip\n  ON ip.proposal_id = wp_items.proposal_id\n  AND ip.institution_id = wp_inst.institution_id\n  AND ip.year_id = wp_items.year_id\n\n\n  )"}, {"Label": "CAI", "Type": "model", "SQL": "no sql?"}, {"Label": "cai_applications", "Type": "explore", "SQL": "no sql?"}, {"Label": "cai_agency_contributions", "Type": "view", "SQL": "(\n\n  SELECT\n\n  all_agencies_id.id AS 'proposals_institutions_id',\n  all_agencies_id.institution_id AS 'institution_id',\n  all_agencies_id.proposal_id AS 'proposal_id',\n  all_agencies.NAME AS 'partner_agencies',\n  all_agencies.`type` AS 'partner_agency_type',\n  in_kind_type.string_val AS 'in_kind_match_type',\n\nfinancial_contribution.int_val AS 'financial_contribution',\nin_kind.int_val AS 'in_kind_match'\n\n##join all institutions to get all participating agencies\nFROM  proposals_institutions all_agencies_id\n\nJOIN institutions all_agencies ON all_agencies.id = all_agencies_id.institution_id\n\n##now join financial contributions onto their corresponding institution\nLEFT JOIN effort_areas contribution_institution ON contribution_institution.parent_proposal_id = all_agencies_id.proposal_id\nAND contribution_institution.institution_id = all_agencies_id.institution_id\nAND contribution_institution.effort_area_type = 'application_contributions' AND contribution_institution.deleted = 0\n\nLEFT JOIN proposal_attributes financial_contribution ON contribution_institution.id = financial_contribution.effort_area_id\n AND financial_contribution.attribute_name = 'financial_contribution'\n\nLEFT JOIN proposal_attributes in_kind ON in_kind.effort_area_id = contribution_institution.id\nAND in_kind.attribute_name = 'in_kind_match'\n\nLEFT JOIN proposal_attributes in_kind_type ON in_kind_type.effort_area_id = contribution_institution.id\nAND in_kind_type.attribute_name = 'in_kind_match_type'\n\n\n\n\n  )"}, {"Label": "cai_application_status", "Type": "view", "SQL": "(\n\n  SELECT\nt.proposal_id,\n(case when t.completed = 1 then 'Submitted'\nelse 'Draft' end) as status,\nt.task_type,\nt.fund_id\nFROM tasks t\nWHERE t.task_type = 'rfa_application_submit' AND t.id IN\n(SELECT MAX(tasks.id)\nFROM tasks\nGROUP BY task_type, proposal_id, fund_id )\n\n\n\n  )"}, {"Label": "cai_apprentice_ratio", "Type": "view", "SQL": "(\n\n  SELECT\nnum.proposal_id,\nnum.int_val AS journeymen_numerator,\ndenom.int_val AS apprentice_denominator\nFROM proposal_attributes num\nJOIN proposal_attributes denom ON denom.proposal_id = num.proposal_id AND denom.attribute_name = 'apprentice_ratio_denominator'\nWHERE num.attribute_name = 'apprentice_ratio_numerator'\n\n\n  )"}, {"Label": "cai_curriculum_topics", "Type": "view", "SQL": "(\n\nSELECT\nea.id AS effort_area_id,\nea.parent_effort_area_id,\nea.title,\nea.description,\npa.int_val AS hours\n\nFROM effort_areas ea\nJOIN proposal_attributes pa ON pa.effort_area_id = ea.id\n\nWHERE ea.effort_area_type = 'curriculum_topics'\n\n\n\n  )"}, {"Label": "cai_details", "Type": "view", "SQL": "(\n\n  SELECT\nip.id AS proposals_institutions_id,\nip.proposal_id,\nip.institution_id,\npf.fund_id,\nf.name AS fund,\nf.`key`,\np.title,\np.description,\np.start_date,\np.end_date\n\n\nFROM proposals_institutions ip\n\nJOIN proposals_funds pf ON pf.proposal_id = ip.proposal_id\nJOIN funds f ON f.id = pf.fund_id\n\nJOIN proposals p ON p.id = ip.proposal_id\n\n\nWHERE f.`key` = 'cai' OR f.parent_key = 'cai'\n\n  )"}, {"Label": "cai_journeyman_wages", "Type": "view", "SQL": "(\n\n  SELECT\n\n\nwage_basic.proposal_id,\nwage_basic.effort_area_id,\nwage_basic.string_val AS 'basic_rate',\nwage_tax.string_val AS 'taxable_rate',\nwage_health.string_val AS 'health_welfare',\nwage_pen.string_val AS 'pension',\nwage_vaca.string_val AS 'vacation',\nwage_train.string_val AS 'training',\nwage_other.string_val AS 'other'\nFROM proposal_attributes wage_basic\n\nJOIN proposal_attributes wage_tax ON wage_tax.effort_area_id = wage_basic.effort_area_id AND wage_tax.attribute_name = 'wages_taxable_rate'\nJOIN proposal_attributes wage_health ON wage_health.effort_area_id = wage_basic.effort_area_id AND wage_health.attribute_name = 'wages_health'\nJOIN proposal_attributes wage_pen ON wage_pen.effort_area_id = wage_basic.effort_area_id AND wage_pen.attribute_name = 'wages_pension'\nJOIN proposal_attributes wage_vaca ON wage_vaca.effort_area_id = wage_basic.effort_area_id AND wage_vaca.attribute_name = 'wages_vacation'\nJOIN proposal_attributes wage_train ON wage_train.effort_area_id = wage_basic.effort_area_id AND wage_train.attribute_name = 'wages_training'\nJOIN proposal_attributes wage_other ON wage_other.effort_area_id = wage_basic.effort_area_id AND wage_other.attribute_name = 'wages_other'\n\n\nWHERE wage_basic.attribute_name = 'wages_basic_rate'\n)"}, {"Label": "cai_need", "Type": "view", "SQL": "(\n\n  SELECT\npa.id AS proposal_attribute_id,\npa.proposal_id,\ni.id AS region_id,\ni.name AS region,\nsector_id.int_val AS 'sector_id',\nsectors.name AS 'sector',\nlmi.string_val AS 'lmi_type'\n\nFROM proposal_attributes pa\nJOIN institutions i ON i.id = pa.int_val AND pa.attribute_name = 'application_region'\n\nleft JOIN proposal_attributes sector_id ON sector_id.proposal_id = pa.proposal_id AND sector_id.attribute_name = 'sector_id'\nJOIN sectors ON sectors.id = sector_id.int_val\n\n\nleft JOIN proposal_attributes lmi ON lmi.proposal_id = pa.proposal_id AND lmi.attribute_name = 'lmi_type'\n\n\n  )"}, {"Label": "cai_objectives", "Type": "view", "SQL": "effort_areas"}, {"Label": "cai_paid_geo", "Type": "view", "SQL": "(\n\n\n      SELECT\n    pa.id,\n    pa.proposal_id,\n\n    pa.int_val AS geo_id,\n    cities.name AS city,\n    (case when counties.name IS NOT NULL then CONCAT(counties.name, ' County')\n    ELSE CONCAT(county_parent.name, ' County') END) AS county\n\n\n    FROM\n    proposal_attributes pa\n\n    left JOIN institutions cities ON pa.int_val = cities.id\n      AND cities.`type` = 'City'\n    left JOIN institutions counties ON pa.int_val = counties.id\n      AND counties.`type` = 'County'\n\n    left JOIN institutions_relationships ir ON ir.institution_id = pa.int_val\n    left JOIN institutions county_parent ON county_parent.id = ir.institution_parent_id\n      AND county_parent.`type` = 'County'\n\n\n\n\n    WHERE pa.attribute_name  = 'paid_in_geo_institution_ids'\n\n\n      )"}, {"Label": "cai_plan_budget", "Type": "view", "SQL": "(\n\n\nSELECT\nip.id AS proposals_institutions_id,\nea.id as effort_area_id,\nea.effort_area_type,\nea.parent_proposal_id,\n\nea.duration_id,\nd.year_id,\nea.title,\nea.description,\nea.institution_id,\n\n\ngrant_funds.int_val AS grant_funds_amount,\nobject_code_id.int_val AS object_code,\nobject_codes.NAME AS object_code_name,\nmonetary_match.int_val AS monetary_match_amount,\nactivities.int_val AS activity_effort_area_id\n\nFROM  effort_areas ea\n\nJOIN proposals_institutions ip ON ip.institution_id = ea.institution_id AND ip.proposal_id = ea.parent_proposal_id\n\nJOIN proposal_attributes grant_funds ON grant_funds.effort_area_id = ea.id AND grant_funds.attribute_name = 'grant_funds_amount'\nJOIN proposal_attributes object_code_id ON object_code_id.effort_area_id = ea.id AND object_code_id.attribute_name = 'object_code_id'\nJOIN proposal_attributes monetary_match ON monetary_match.effort_area_id = ea.id AND monetary_match.attribute_name = 'monetary_match_amount'\nJOIN proposal_attributes activities ON activities.effort_area_id = ea.id AND activities.attribute_name = 'related_activities'\nJOIN object_codes ON object_codes.id = object_code_id.int_val\nJOIN durations d ON d.id = ea.duration_id\n\nWHERE ea.effort_area_type = 'plan_budget_items'\n\n\n )"}, {"Label": "cai_proposal_attributes", "Type": "view", "SQL": "proposal_attributes"}, {"Label": "cai_soc_codes", "Type": "view", "SQL": "(\n\nSELECT\npa.id,\npa.attribute_name,\npa.proposal_id,\npa.effort_area_id,\npa.int_val AS soc_code_id,\nc.value AS soc_code_value\nFROM proposal_attributes pa\nJOIN codes c ON c.id = pa.int_val\n\nWHERE pa.attribute_name = 'soc_code_id'\n\n  )"}, {"Label": "cai_state_allocations", "Type": "view", "SQL": "(\n\n  SELECT\na.id,\na.amount,\na.from_institution_id,\nifrom.name as from_institution,\na.to_institution_id,\nito.name AS to_institution,\na.fund_id,\na.year_id,\nyears.name AS academic_year,\na.type,\nf.name as fund_name,\nf.duration,\nf.`key`,\nf.parent_key\nFROM allocations a\nJOIN funds f ON f.id = a.fund_id\nJOIN institutions ifrom ON ifrom.id = a.from_institution_id\nJOIN institutions ito ON ito.id = a.to_institution_id\nJOIN years ON years.id = a.year_id\nWHERE f.`key` = 'cai' OR f.parent_key = 'cai'\n\n  )"}, {"Label": "cai_trained_geo", "Type": "view", "SQL": "(\n\n\n  SELECT\npa.id,\npa.proposal_id,\n\npa.int_val AS geo_id,\ncities.name AS city,\n(case when counties.name IS NOT NULL then CONCAT(counties.name, ' County')\nELSE CONCAT(county_parent.name, ' County') END) AS county\n\n\nFROM\nproposal_attributes pa\n\nleft JOIN institutions cities ON pa.int_val = cities.id\n  AND cities.`type` = 'City'\nleft JOIN institutions counties ON pa.int_val = counties.id\n  AND counties.`type` = 'County'\n\nleft JOIN institutions_relationships ir ON ir.institution_id = pa.int_val\nleft JOIN institutions county_parent ON county_parent.id = ir.institution_parent_id\n  AND county_parent.`type` = 'County'\n\n\n\n\nWHERE pa.attribute_name  = 'trained_in_geo_institution_ids'\n\n\n  )"}, {"Label": "cai_workplan_activities", "Type": "view", "SQL": "(\n\n\n  SELECT\n    ea.id AS effort_area_id,\n    ea.deleted,\n    ea.effort_area_type,\n    ea.parent_proposal_id,\n    ea.title,\n    ea.description,\n    start_date.string_val AS 'start_date',\n    end_date.string_val AS 'end_date',\n    metric_ids.int_val AS 'metric_id',\n    md.name as activity_metric,\n    user_ids.int_val AS user_id,\n    objective_id.int_val AS objective_ea_id\n\n  FROM effort_areas ea\n\n  JOIN proposal_attributes start_date ON start_date.effort_area_id = ea.id AND start_date.attribute_name = 'start_date'\n  JOIN proposal_attributes end_date ON end_date.effort_area_id = ea.id AND end_date.attribute_name = 'end_date'\n\n  JOIN proposal_attributes metric_ids ON metric_ids.effort_area_id = ea.id AND metric_ids.attribute_name = 'success_metrics'\n  JOIN metric_definitions  md ON md.id = metric_ids.int_val\n\n  JOIN proposal_attributes user_ids ON user_ids.effort_area_id = ea.id AND user_ids.attribute_name = 'responsible_user_ids'\n\n  JOIN proposal_attributes objective_id ON objective_id.effort_area_id = ea.id AND objective_id.attribute_name = 'objective_ea_id'\n\n  WHERE ea.effort_area_type = 'workplan_activities' and ea.deleted = 0\n\n\n  )"}, {"Label": "cai_workplan_outcomes", "Type": "view", "SQL": "(\n\n  SELECT\nea.id AS effort_area_id,\nea.deleted,\nea.effort_area_type,\nea.parent_proposal_id,\nea.title,\nea.description,\n\nmetric_ids.int_val AS 'metric_id',\nmd.name as outcome_metric,\n\nobjective_id.int_val AS objective_ea_id\n\nFROM effort_areas ea\n\n\nJOIN proposal_attributes metric_ids ON metric_ids.effort_area_id = ea.id AND metric_ids.attribute_name = 'success_metrics'\nJOIN metric_definitions  md ON md.id = metric_ids.int_val\n\n\nJOIN proposal_attributes objective_id ON objective_id.effort_area_id = ea.id AND objective_id.attribute_name = 'objective_ea_id'\n\nWHERE ea.effort_area_type = 'workplan_outcomes' AND ea.deleted = 0\n\n\n  )"}, {"Label": "cai_work_processes", "Type": "view", "SQL": "(\n\n\n  SELECT\nea.id AS effort_area_id,\nea.parent_effort_area_id,\nea.parent_proposal_id AS proposal_id,\nea.description AS work_process,\npa.int_val AS hours\nFROM effort_areas ea\nJOIN proposal_attributes pa ON pa.effort_area_id = ea.id\nWHERE ea.effort_area_type = 'work_processes'\n\n\n  )"}, {"Label": "dw_lmi", "Type": "view", "SQL": "(\n\nSELECT\nip.id AS proposals_institutions_id,\ndt.*\n\n\nFROM dw_lmi dt\nJOIN proposals_institutions ip ON ip.institution_id = dt.institution_id\n  AND ip.proposal_id = dt.proposal_id\n\n  )"}, {"Label": "fiscal_agents", "Type": "view", "SQL": "institutions"}, {"Label": "fiscal_report_status", "Type": "view", "SQL": "(\n\nSELECT\nip.id AS proposals_institutions_id,\nfr.fund_id,\nip.proposal_id,\nd.year_id,\nfr.require_explanation\n\nFROM fiscal_reports fr\nJOIN durations d ON d.id = fr.duration_id\nJOIN proposals_institutions ip ON ip.institution_id = fr.institution_id AND ip.proposal_id = fr.proposal_id\n\n\n\n  )"}, {"Label": "funds", "Type": "view", "SQL": "funds"}, {"Label": "GP", "Type": "model", "SQL": "no sql?"}, {"Label": "guided_pathways", "Type": "explore", "SQL": "no sql?"}, {"Label": "gp_status", "Type": "view", "SQL": "(SELECT\ngp_submitted.proposal_id,\n\n(case\n  when gp_submitted.completed = 0 then 'Draft'\n  when gp_submitted.completed = 0 and gp_approved.completed = 1 then 'Draft'\n  when gp_submitted.completed = 1 AND gp_approved.completed = 0 then 'Submitted'\n  when gp_submitted.completed = 1 AND gp_approved.completed = 1 then 'Approved'\n  ELSE 'Draft'\nEND) AS proposal_status,\n\ngp_submitted.completed as is_submitted,\ngp_approved.completed as is_approved\n\n\n\n\nfrom tasks gp_submitted\n\nleft join tasks gp_approved\n  ON  gp_approved.proposal_id = gp_submitted.proposal_id\n  AND gp_approved.id in (\n    select\n        max(tasks.id)\n      from tasks\n      where task_type = 'gp_proposal_approve'\n      group by `task_type`, `proposal_id`, `duration_id`,\n       `institution_id`, `year_id`, `annual_plan_id`,\n        `cfad_id`, `user_id`, `fund_id`)\n\nWHERE gp_submitted.id IN (\n    select\n        max(tasks.id)\n      from tasks\n      where task_type = 'gp_proposal_submit'\n      group by `task_type`, `proposal_id`, `duration_id`,\n       `institution_id`, `year_id`, `annual_plan_id`,\n        `cfad_id`, `user_id`, `fund_id`)\n  )"}, {"Label": "gp_workplans", "Type": "view", "SQL": "(\n\nSELECT\nwpi.id,\nwpi.proposal_id,\nwpi.major_outcomes,\n\nwpi.major_activities,\nwpi.year_1,\nwpi.year_2,\nwpi.year_3,\nwpi.year_4,\n\nwpi.adoption_status_2,\nwpi.workplan_type_id,\n\n(case\n  when year_1 = 1 then 2018\n  when year_2 = 1 then 2019\n  when year_3 = 1 then 2020\n  when year_4 = 1 then 2021\n\nEND) AS start_year,\n\n(case\n  when year_4 = 1 then 2022\n  when year_3 = 1 then 2021\n  when year_2 = 1 then 2020\n  when year_1 = 1 then 2019\nEND) AS end_year,\n\nwpt.header\n\nFROM workplan_items wpi\nJOIN workplan_types wpt ON wpt.id = wpi.workplan_type_id\n\n  )"}, {"Label": "gp_wp_unpivoted", "Type": "view", "SQL": "(\n\nSELECT wpi.id, 2019 school_year FROM workplan_items wpi WHERE wpi.year_1 =1\n\nUNION ALL\n\nSELECT wpi.id, 2020 school_year FROM workplan_items wpi WHERE wpi.year_2 = 1\n\nUNION ALL\n\nSELECT wpi.id, 2021 school_year FROM workplan_items wpi WHERE wpi.year_3 = 1\n\nUNION ALL\n\nSELECT wpi.id,  2022 school_year FROM workplan_items wpi WHERE wpi.year_4 = 1\n\n\n  )"}, {"Label": "job_categories", "Type": "view", "SQL": "job_categories"}, {"Label": "LVG", "Type": "model", "SQL": "no sql?"}, {"Label": "local_vision_goals", "Type": "explore", "SQL": "no sql?"}, {"Label": "lvg_baseline_metrics", "Type": "view", "SQL": "(SELECT\n  baseline_metrics.id AS ssm_id,\n  baseline_metrics.institution_id,\n  baseline_metrics.metric_definition_id,\n  baseline_metrics.impacted_group_id,\n  baseline_metrics.section,\n\n(CASE WHEN baseline_metrics.metric_definition_id IN (77, 80) THEN baseline_metrics.perc*100 WHEN baseline_metrics.metric_definition_id NOT IN (77, 80) THEN baseline_metrics.num END) AS baseline\nFROM student_success_metrics baseline_metrics\nWHERE (\n  (baseline_metrics.metric_definition_id IN (128,135,127,136, 138) AND baseline_metrics.duration_id = 16)\n    OR\n  (baseline_metrics.metric_definition_id IN (78, 80, 129) AND baseline_metrics.duration_id = 1)\n    OR\n  (baseline_metrics.metric_definition_id=77 AND baseline_metrics.duration_id = 167)\n) AND\n(baseline_metrics.num IS NOT NULL OR baseline_metrics.perc IS NOT NULL) )"}, {"Label": "lvg_metrics_digs", "Type": "view", "SQL": "(\n\n  SELECT\n  digs.id AS impacted_group_id,\n  digs.NAME AS impacted_group,\n  digs.`type` AS dig_type,\n  md.id AS metric_definition_id,\n  md.NAME AS metric_name,\n  md.units AS metric_units,\n    (case when digs.id = 32 then\n    (case\n      when md.id = 128 then '1A'\n      when md.id = 135 then '1B'\n      when md.id = 127 then '1C'\n      when md.id = 136 then '2A'\n      when md.id = 129 then '2B'\n      when md.id = 138 then '3A'\n      when md.id = 78 then '4A'\n      when md.id = 80 then '4B'\n      when md.id = 77 then  '4C'\n      else null\n    end)\n  else\n    (case\n      when md.id = 128 then '5.1A'\n      when md.id = 135 then '5.1B'\n      when md.id = 127 then '5.1C'\n      when md.id = 136 then '5.2A'\n      when md.id = 129 then '5.2B'\n      when md.id = 138 then '5.3A'\n      when md.id = 78 then '5.4A'\n      when md.id = 80 then '5.4B'\n      when md.id = 77 then  '5.4C'\n      else null\n    end)\n  end) as goal,\n  (case\n    when md.id = 128 then .2\n    when md.id = 135 then .2\n    when md.id = 127 then .2\n    when md.id = 136 then .35\n    when md.id = 129 then .35\n    when md.id = 138 then -.09\n    when md.id = 77 then  .09\n    else null\n  end) as systemwide_goals\n\n\nFROM impacted_groups digs\nCROSS JOIN metric_definitions md ON md.id IN (128,135,127,136,129,138, 78, 80, 77) AND md.fund_id=24\nWHERE digs.fund_id = 24\n\n  )"}, {"Label": "lvg_proposal_status", "Type": "view", "SQL": "(\n\nSELECT\nsubmit.completed,\nsum(approve.completed),\nCOUNT(approve.role_id),\nsubmit.proposal_id,\n\n(case\n  when SUM(approve.completed) = COUNT(approve.role_id)\n    then 'Certified'\n  when submit.completed = 1\n    then 'Submitted'\n  ELSE 'Draft'\nEND) AS proposal_status\n\n\nFROM tasks submit\n\nleft JOIN tasks approve ON submit.proposal_id = approve.proposal_id\n  AND approve.task_type = 'lvg_proposal_approve'\n  AND approve.id IN\n    (SELECT\n      MAX(tasks.id)\n    FROM tasks\n    GROUP BY task_type, proposal_id, role_id)\n\nWHERE submit.task_type = 'lvg_proposal_submit' AND submit.id IN\n  (SELECT MAX(tasks.id) FROM tasks GROUP BY task_type, proposal_id, role_id )\n\n\nGROUP BY submit.task_type, submit.proposal_id\n\n\n)"}, {"Label": "lvg_target_metrics", "Type": "view", "SQL": "metrics"}, {"Label": "NOVA_Users", "Type": "model", "SQL": "no sql?"}, {"Label": "nova_users", "Type": "explore", "SQL": "no sql?"}, {"Label": "num", "Type": "orphan", "SQL": "(SELECT 1 as n\n    UNION\n    SELECT 2)"}, {"Label": "proposals_institutions_funds_durations_object_codes", "Type": "view", "SQL": "(select * from dw_proposals_institutions_funds_durations_object_codes where fund_id in (1,2))"}, {"Label": "proposals_sectors", "Type": "view", "SQL": "(\n\nSELECT proposals_sectors.proposal_id, sectors.name as Sector\nFROM proposals_sectors\nLEFT JOIN sectors ON sectors.id = proposals_sectors.sector_id\n\n  )"}, {"Label": "roles", "Type": "view", "SQL": "roles"}, {"Label": "SEP", "Type": "model", "SQL": "no sql?"}, {"Label": "sep", "Type": "explore", "SQL": "no sql?"}, {"Label": "sep_baselines", "Type": "view", "SQL": "(\n\nSELECT\nsep.id,\nsep.institution_id,\n\nsep.metric_definition_id,\n\nsep.impacted_group_id,\n\nsep.impacted_group_gender_id,\n\nsep.year_id,\nsep.di_bin AS is_di,\nsep.num AS baseline_num,\nsep.min_equity,\nsep.full_equity\n\n\nFROM sep_metrics sep\n\n\n\nWHERE (sep.di_bin = 1 OR sep.impacted_group_id = 95) and sep.denom>10\n\n  )"}, {"Label": "sep_executive_summary", "Type": "view", "SQL": "(\n\n  select\n  pa.id,\n  pa.proposal_id,\n  pa.string_val\n\n  from proposal_attributes pa\n  where pa.attribute_name = 'executive_summary'\n  )"}, {"Label": "sep_narrative_fields", "Type": "view", "SQL": "(\n\nSELECT\npa.id,\npa.attribute_name,\npa.proposal_id,\npa.text_val\nFROM proposal_attributes pa\n\n\n  )"}, {"Label": "sep_proposal_status", "Type": "view", "SQL": "(\n\nSELECT\nt.id AS task_id,\n(case when t.completed = 1 then \"Submitted\" ELSE \"Draft\" END) AS proposal_status,\nt.proposal_id\nFROM tasks t\nWHERE t.task_type = 'sep_proposal_submit' AND t.deleted = 0 AND t.id IN\n\n(select\n   max(tasks.id)\nfrom tasks\ngroup by `task_type`, `proposal_id`, `duration_id`,\n       `institution_id`, `year_id`, `annual_plan_id`,\n        `cfad_id`, `user_id`, `fund_id`)\n\n  )"}, {"Label": "sep_related_metrics", "Type": "view", "SQL": "(\n\nSELECT\nactivity_id.id AS id,\nactivity_id.int_val AS effort_area_id,\nactivities.id AS activities_id,\nactivity_id.proposal_id,\nactivities.title,\nactivities.description\n\nFROM proposal_attributes activity_id\nLEFT JOIN effort_areas activities ON activities.id = activity_id.effort_area_id AND activities.effort_area_type = 'activity_items'\nWHERE  activity_id.attribute_name = 'related_metrics'\n\n\n  )"}, {"Label": "sep_targets", "Type": "view", "SQL": "(\n\n\nSELECT\nea.id,\n\nea.parent_proposal_id,\n\ngender.int_val AS 'gender_id',\ngenders.NAME AS gender,\n\ndig.int_val AS 'dig_id',\n(case when digs.NAME IS NULL then 'Custom' ELSE digs.name END) AS impacted_group,\n\ncustom.string_val AS custom_demographic,\n\nmetric.int_val AS 'metric_definition_id',\nmd.NAME AS metric_title,\n\ngoals.int_val AS 'target_value'\n\n\nFROM effort_areas ea\n\nJOIN proposal_attributes goals ON ea.id = goals.effort_area_id AND goals.attribute_name = 'goal'\n\nJOIN proposal_attributes gender ON ea.id = gender.effort_area_id AND gender.attribute_name = 'impacted_group_gender_id'\nJOIN impacted_groups genders ON genders.id = gender.int_val\n\nJOIN proposal_attributes metric ON metric.effort_area_id = ea.id AND metric.attribute_name = 'metric_definition_id'\nJOIN metric_definitions md ON md.id = metric.int_val\n\nleft JOIN proposal_attributes dig ON dig.effort_area_id = ea.id AND dig.attribute_name = 'impacted_group_id'\nleft JOIN impacted_groups digs ON digs.id = dig.int_val\n\nLEFT JOIN proposal_attributes custom ON custom.effort_area_id = ea.id AND custom.attribute_name = 'custom_demographic'\n\n\n\nWHERE ea.effort_area_type = 'population_groups' and ea.deleted = 0\n\n  )"}, {"Label": "states", "Type": "view", "SQL": "states"}, {"Label": "SWPk12", "Type": "model", "SQL": "no sql?"}, {"Label": "swpk12_loi", "Type": "explore", "SQL": "no sql?"}, {"Label": "swpk12_project_details", "Type": "view", "SQL": "(\n\n  SELECT\n  p.id as proposal_id,\n  p.type as proposal_type,\n  p.title AS pathway_improvement,\n  p.description,\n\n  (case\n    when loi_submitted.completed = 0 or loi_submitted.completed is null then 'Draft'\n    when loi_approved.completed = 1 then 'Approved'\n    when loi_submitted.completed = 1 then 'Submitted'\n\n    else 'Draft'\n  end ) AS 'loi_status',\n\n  (case\n\n    when approved.completed = 1 then 'Approved'\n    when submitted.completed = 1 then 'Submitted'\n    when submitted.completed = 0 then 'Draft'\n    when submitted.completed is null then 'Not Started'\n    else 'Draft'\n  end ) AS 'application_status',\n\n\n\n  application_region.NAME AS 'application_region',\n\n  lcap_alignment.bool_val AS 'lcap_alignment',\n  collaborative_partnerships.text_val AS 'collaborative_partnerships',\n\n  applying_to_cte.bool_val AS 'applying_to_cte',\n\n  serves_dropouts.int_val AS 'serves_dropouts',\n\n  estimated_budget.int_val AS 'estimated_budget',\n  budget_narrative.text_val AS 'budget_narrative',\n\n  is_rural_district.bool_val AS 'is_rural_district'\n\n\nFROM proposals p\nJOIN proposals_funds pf ON pf.proposal_id = p.id AND pf.fund_id = 23\n\nLEFT JOIN proposal_attributes lcap_alignment ON lcap_alignment.proposal_id = p.id AND lcap_alignment.attribute_name = 'lcap_alignment'\nLEFT JOIN proposal_attributes collaborative_partnerships ON collaborative_partnerships.proposal_id = p.id AND collaborative_partnerships.attribute_name = 'collaborative_partnerships'\n\nLEFT JOIN proposal_attributes applying_to_cte ON applying_to_cte.proposal_id = p.id AND applying_to_cte.attribute_name = 'applying_to_cte'\n\nLEFT JOIN proposal_attributes serves_dropouts ON serves_dropouts.proposal_id = p.id AND serves_dropouts.attribute_name = 'serves_dropouts'\n\nLEFT JOIN proposal_attributes estimated_budget ON estimated_budget.proposal_id = p.id AND estimated_budget.attribute_name = 'estimated_budget'\nLEFT JOIN proposal_attributes budget_narrative ON budget_narrative.proposal_id = p.id AND budget_narrative.attribute_name = 'budget_narrative'\n\n\nLEFT JOIN proposal_attributes application_region_ids ON application_region_ids.proposal_id = p.id AND application_region_ids.attribute_name = 'application_region'\nLEFT JOIN institutions application_region ON application_region.id = application_region_ids.int_val\n\nLEFT JOIN proposal_attributes is_rural_district ON is_rural_district.proposal_id = p.id AND is_rural_district.attribute_name = 'is_rural_district'\n\n\n\nleft join tasks submitted\n  on submitted.proposal_id = p.id and submitted.task_type = 'swpk_application_submit'\n    and submitted.id IN (\n      SELECT\n          max(tasks.id)\n      from tasks\n\n      group by `task_type`,  `proposal_id`, `duration_id`,\n       `institution_id`, `year_id`, `annual_plan_id`,\n        `cfad_id`, `user_id`, `fund_id`)\n\nleft join tasks approved\n  on  approved.proposal_id = p.id and approved.task_type = 'swpk_application_approve'\n  and approved.id in (\n    select\n        max(tasks.id)\n      from tasks\n\n      group by  `task_type`, `proposal_id`, `duration_id`,\n       `institution_id`, `year_id`, `annual_plan_id`,\n        `cfad_id`, `user_id`, `fund_id`)\n#test\nleft join tasks loi_submitted\n  on loi_submitted.proposal_id = p.id and loi_submitted.task_type = 'swpk_loi_submit'\n  and loi_submitted.id in (\n    select\n        max(tasks.id)\n      from tasks\n\n      group by `task_type`, `proposal_id`, `duration_id`,\n       `institution_id`, `year_id`, `annual_plan_id`,\n        `cfad_id`, `user_id`, `fund_id`)\n\nleft join tasks loi_approved\n  on  loi_approved.proposal_id = p.id and loi_approved.task_type = 'swpk_loi_approve'\n  and loi_approved.id in (\n    select\n        max(tasks.id)\n      from tasks\n\n      group by `task_type`, `proposal_id`, `duration_id`,\n       `institution_id`, `year_id`, `annual_plan_id`,\n        `cfad_id`, `user_id`, `fund_id`)\n\nwhere p.deleted = 0\n  )"}, {"Label": "plans", "Type": "explore", "SQL": "no sql?"}, {"Label": "swpk12_activity_metrics", "Type": "view", "SQL": "(\n\n  SELECT\nactivity_metrics.effort_area_id,\nactivity_metrics.int_val AS metric_definitions_id,\nmd.NAME\n\nFROM proposal_attributes activity_metrics\nJOIN metric_definitions md ON md.id = activity_metrics.int_val\nWHERE  activity_metrics.attribute_name = 'activity_metrics'\n\n  )"}, {"Label": "swpk12_agency_contributions", "Type": "view", "SQL": "(\n    SELECT\n\n  all_agencies_id.id AS 'proposal_institution_id',\n  all_agencies_id.institution_id AS 'institution_id',\n  all_agencies_id.proposal_id AS 'proposal_id',\n  all_agencies.NAME AS 'partner_agencies',\n  all_agencies.`type` AS 'partner_agency_type',\n\n\nfinancial_contribution.int_val AS 'financial_contribution',\nin_kind.int_val AS 'in_kind_match',\n\nada_number.string_val AS 'ada_number',\n\nGROUP_CONCAT(participating_schools.string_val SEPARATOR ', ') AS 'participating_schools'\n\n##join all institutions to get all participating agencies\nFROM  proposals_institutions all_agencies_id\n\nJOIN proposals_funds pf ON pf.proposal_id = all_agencies_id.proposal_id AND pf.fund_id = 23 #necessary to limit to only swpk12 fund\n\nJOIN institutions all_agencies ON all_agencies.id = all_agencies_id.institution_id\n\n##now join financial contributions onto their corresponding institution\nLEFT JOIN effort_areas contribution_institution ON contribution_institution.parent_proposal_id = all_agencies_id.proposal_id\nAND contribution_institution.institution_id = all_agencies_id.institution_id\nAND contribution_institution.effort_area_type = 'application_contributions' AND contribution_institution.deleted = 0\n\nLEFT JOIN proposal_attributes financial_contribution ON contribution_institution.id = financial_contribution.effort_area_id\n AND financial_contribution.attribute_name = 'financial_contribution'\n\nLEFT JOIN proposal_attributes in_kind ON in_kind.effort_area_id = contribution_institution.id\nAND in_kind.attribute_name = 'in_kind_match'\n\n\nLEFT JOIN proposal_attributes ada_number ON ada_number.effort_area_id = contribution_institution.id\nAND ada_number.attribute_name = 'ada_number'\n\nLEFT JOIN proposal_attributes participating_schools ON  participating_schools.effort_area_id = contribution_institution.id\nAND participating_schools.attribute_name = 'participating_schools'\n\n\nGROUP BY all_agencies_id.id, all_agencies_id.proposal_id, all_agencies_id.institution_id\n\n\n\n  )"}, {"Label": "swpk12_application_plans", "Type": "view", "SQL": "(\n\nSELECT\np.id AS proposal_id,\np.parent_id AS application_id\nFROM proposals p\nWHERE p.`type` = 'plan'\n\n  )"}, {"Label": "swpk12_available_funds", "Type": "view", "SQL": "(\n\nSELECT\n\n\n  all_agencies_id.proposal_id AS 'proposal_id',\n\nsum(financial_contribution.int_val) AS 'financial_contribution',\nsum(in_kind.int_val) AS 'in_kind_match'\n\n\n\n##join all institutions to get all participating agencies\nFROM  proposals_institutions all_agencies_id\n\nJOIN proposals_funds pf ON pf.proposal_id = all_agencies_id.proposal_id AND pf.fund_id = 23 #necessary to limit to only swpk12 fund\n\n\n\n##now join financial contributions onto their corresponding institution\nLEFT JOIN effort_areas contribution_institution ON contribution_institution.parent_proposal_id = all_agencies_id.proposal_id\nAND contribution_institution.institution_id = all_agencies_id.institution_id\nAND contribution_institution.effort_area_type = 'application_contributions' AND contribution_institution.deleted = 0\n\nLEFT JOIN proposal_attributes financial_contribution ON contribution_institution.id = financial_contribution.effort_area_id\n AND financial_contribution.attribute_name = 'financial_contribution'\n\nLEFT JOIN proposal_attributes in_kind ON in_kind.effort_area_id = contribution_institution.id\nAND in_kind.attribute_name = 'in_kind_match'\n\n\nGROUP BY all_agencies_id.proposal_id\n\n\n\n\n  )"}, {"Label": "swpk12_budget_followup", "Type": "view", "SQL": "(\n\nSELECT\nr.id,\nr.user_id,\nr.proposal_id,\nrn.`comment`,\n(case when rn.score = 0 then 'Adequate'\n  when rn.score = -1 then 'Undecided'\n  when rn.score > 0 then 'Inadequate'\n  END) AS budget_decision,\n(case when rn.score > 0 then rn.score\nELSE NULL END ) AS suggested_budget\n\nFROM resources r\nJOIN resource_notes rn ON rn.resource_id = r.id\nWHERE r.area_name = 'budget-followup' AND rn.deleted = 0\n\n\n  )"}, {"Label": "swpk12_descriptions_of_need", "Type": "view", "SQL": "(\n\nSELECT\n\npa.proposal_id,\npa.text_val AS pathway_narrative,\ncte.text_val AS cte_narrative\n\nFROM proposal_attributes pa\n\nJOIN proposal_attributes cte ON cte.proposal_id = pa.proposal_id AND cte.attribute_name = 'cte_status_narrative'\n\n\nWHERE pa.attribute_name = 'pathway_selection_narrative'\n\n  )"}, {"Label": "swpk12_funding_status", "Type": "view", "SQL": "(\n\n\nSELECT\n\n\nsubmit.store,\n(case\n  when approve.completed = 1 then 'Offer Accepeted'\n  when submit.completed = 1 then 'Offer Pending'\n  when submit.completed = 0 then 'Offer in Draft'\nEND) AS funding_status,\n\nSUBSTRING(submit.client_state, LOCATE('\"requested_amount\":', submit.client_state) +19, LOCATE(',\"', submit.client_state, LOCATE('\"requested_amount\":', submit.client_state))\n  -LOCATE('\"requested_amount\":', submit.client_state)-19) AS requested_amount,\nSUBSTRING(submit.client_state, LOCATE('\"offered_amount\":', submit.client_state) +17, LOCATE(',\"', submit.client_state, LOCATE('\"offered_amount\":', submit.client_state))\n  -LOCATE('\"offered_amount\":', submit.client_state)-17) AS offered_amount,\n\n\nsubmit.completed,\napprove.completed AS approval,\n\nsubmit.proposal_id\n\n\nFROM tasks submit\n\nleft JOIN tasks approve ON approve.proposal_id = submit.proposal_id\n  AND approve.task_type = 'swpk_application_funding_approve'\n  AND approve.id IN (\n  select\n    max(tasks.id)\n  from tasks\n  group by `task_type`, `proposal_id`, `duration_id`,\n       `institution_id`, `year_id`, `annual_plan_id`,\n        `cfad_id`, `user_id`, `fund_id`)\n\nWHERE submit.task_type = 'swpk_application_funding_submit' AND submit.deleted = 0  AND submit.id IN (\nselect\n   max(tasks.id)\nfrom tasks\ngroup by `task_type`, `proposal_id`, `duration_id`,\n       `institution_id`, `year_id`, `annual_plan_id`,\n        `cfad_id`, `user_id`, `fund_id`)\n\n\n\n  )"}, {"Label": "swpk12_impacted_groups", "Type": "view", "SQL": "impacted_groups"}, {"Label": "swpk12_lead_agency", "Type": "view", "SQL": "(\n\n  SELECT\n\n  lead_agency_id.institution_id,\n  lead_agency_id.proposal_id,\n  concat(project_lead_contact.last_name, ', ', project_lead_contact.first_name) as lead_contact_name,\n  project_lead_contact.email_address,\n  project_lead_contact.phone,\n  lead_agency_lineage.name as lead_agency,\n  lead_agency_lineage.type as lead_agency_type,\n  lead_agency_lineage.district as lead_agency_district,\n  lead_agency_lineage.region as lead_agency_region,\n  (case when lead_agency_lineage.type in (\"Regional Occupation Center/Program (ROC/P)\", \"County Office of Education (COE)\") then 1\n  else .5 end) as coefficient\n\n\n\nFROM proposals_institutions lead_agency_id\nJOIN proposals_funds pf ON lead_agency_id.proposal_id = pf.proposal_id AND pf.fund_id = 23 and lead_agency_id.is_lead = 1\n\nLEFT JOIN swp_institutions_dt lead_agency_lineage\n  ON lead_agency_lineage.id = lead_agency_id.institution_id AND lead_agency_id.is_lead = 1\n\n#getting lead agency contact information\nLEFT JOIN users_role_scopes project_lead_contact_ids\n  ON project_lead_contact_ids.proposal_id = lead_agency_id.proposal_id\n  AND project_lead_contact_ids.role_id = 23  #selecting project lead contact role_id = 23\nLEFT JOIN users project_lead_contact        # joining users to get the contact name\n  ON project_lead_contact.id = project_lead_contact_ids.user_id\n\n\n\n\n\n\n  )"}, {"Label": "swpk12_loi_details", "Type": "view", "SQL": "(\n\n  SELECT\n  p.id,\n  p.title AS pathway_improvement,\n  p.description,\n\n   (case\n    when loi_submitted.completed = 0 then 'Draft'\n    when loi_approved.completed = 1 then 'Approved'\n    when loi_submitted.completed = 1 then 'Submitted'\n\n    else 'Draft'\n  end ) AS 'loi_status',\n\n\n\n\n\n  proposal_count.COUNT,\n\n\n\n\n  lcap_alignment.bool_val AS 'lcap_alignment',\n  collaborative_partnerships.text_val AS 'collaborative_partnerships',\n\n  estimated_budget.int_val AS 'estimated_budget'\n\n\n\nFROM proposals p\nJOIN proposals_funds pf ON pf.proposal_id = p.id AND pf.fund_id = 23\n\n\nJOIN (\nSELECT\nCOUNT(DISTINCT p.id) as count\nFROM proposals p\nJOIN proposals_funds pf ON pf.proposal_id = p.id AND pf.fund_id = 23 WHERE p.deleted = 0 ) as proposal_count\n\nLEFT JOIN proposal_attributes lcap_alignment ON lcap_alignment.proposal_id = p.id AND lcap_alignment.attribute_name = 'lcap_alignment'\nLEFT JOIN proposal_attributes collaborative_partnerships ON collaborative_partnerships.proposal_id = p.id AND collaborative_partnerships.attribute_name = 'collaborative_partnerships'\n\n\nLEFT JOIN proposal_attributes estimated_budget ON estimated_budget.proposal_id = p.id AND estimated_budget.attribute_name = 'estimated_budget'\nLEFT JOIN proposal_attributes budget_narrative ON budget_narrative.proposal_id = p.id AND budget_narrative.attribute_name = 'budget_narrative'\n\n\n#join loi tasks to distinguish between applications and lois\nleft join tasks loi_submitted\n  on loi_submitted.proposal_id = p.id\n  and loi_submitted.id in (\n    select\n        max(tasks.id)\n      from tasks\n      where task_type = 'swpk_loi_submit'\n      group by `task_type`, `proposal_id`, `duration_id`,\n       `institution_id`, `year_id`, `annual_plan_id`,\n        `cfad_id`, `user_id`, `fund_id`)\n\nleft join tasks loi_approved\n  on  loi_approved.proposal_id = p.id\n  and loi_approved.id in (\n    select\n        max(tasks.id)\n      from tasks\n      where task_type = 'swpk_loi_approve'\n      group by `task_type`, `proposal_id`, `duration_id`,\n       `institution_id`, `year_id`, `annual_plan_id`,\n        `cfad_id`, `user_id`, `fund_id`)\n\nWHERE p.deleted = 0\n\n  )"}, {"Label": "swpk12_pathway_sectors", "Type": "view", "SQL": "(\n\nSELECT\npa.id,\npa.proposal_id,\npa.int_val AS sector_id,\ns.NAME AS sector_name\nFROM proposal_attributes pa\nJOIN sectors s ON s.id = pa.int_val\nWHERE pa.attribute_name = 'pathway_sectors'\n\n  )"}, {"Label": "swpk12_plan_activities", "Type": "view", "SQL": "(\n\n  SELECT\nea.id AS effort_area_id,\nea.effort_area_type,\nea.parent_proposal_id,\n\nea.title,\nea.description,\n\n\ntimelines.text_val AS timeline,\noutcomes.text_val AS performance_outcomes,\nperson.string_val AS responsible_person\n\nFROM effort_areas ea\n\nJOIN proposal_attributes timelines ON timelines.effort_area_id = ea.id AND timelines.attribute_name = 'timeline'\nJOIN proposal_attributes outcomes ON outcomes.effort_area_id = ea.id AND outcomes.attribute_name = 'performance_outcomes'\nJOIN proposal_attributes person ON person.effort_area_id = ea.id AND person.attribute_name = 'responsible_person'\n\n\nWHERE ea.effort_area_type = 'statement_of_works'\n\n\n  )"}, {"Label": "swpk12_plan_allocations", "Type": "view", "SQL": "allocations"}, {"Label": "swpk12_plan_budget_items", "Type": "view", "SQL": "(\n\nSELECT\nea.id,\nea.effort_area_type,\nea.parent_proposal_id,\n\nea.duration_id,\nea.title as budget_item,\nea.description,\nea.institution_id,\n\n\ngrant_funds.int_val AS grant_funds_amount,\nobject_code_id.int_val AS object_code,\nobject_codes.NAME AS object_code_name,\nmonetary_match.int_val AS monetary_match_amount,\nactivities.int_val AS activity_effort_area_id\n\nFROM  effort_areas ea\n\n\nJOIN proposal_attributes object_code_id ON object_code_id.effort_area_id = ea.id AND object_code_id.attribute_name = 'object_code_id'\nJOIN object_codes ON object_codes.id = object_code_id.int_val\nLEFT JOIN proposal_attributes grant_funds ON grant_funds.effort_area_id = ea.id AND grant_funds.attribute_name = 'grant_funds_amount'\n\nLEFT JOIN proposal_attributes monetary_match ON monetary_match.effort_area_id = ea.id AND monetary_match.attribute_name = 'monetary_match_amount'\nLEFT JOIN proposal_attributes activities ON activities.effort_area_id = ea.id AND activities.attribute_name = 'related_activities'\n\n\n\nWHERE ea.effort_area_type = 'plan_budget_items' and ea.deleted = 0\n\n  )"}, {"Label": "swpk12_plan_details", "Type": "view", "SQL": "(\n\n   SELECT\n  p.id as proposal_id,\n  p.title AS pathway_improvement,\n  p.description,\n\n  (case\n\n    when approved.completed = 1 then 'Approved'\n    when submitted.completed = 1 then 'Submitted'\n    when submitted.completed = 0 then 'Draft'\n    when submitted.completed is null then 'Not Started'\n    else 'Draft'\n  end ) AS plan_status,\n\n\n\n  application_region.NAME AS 'application_region',\n\n\n  collaborative_partnerships.text_val AS 'collaborative_partnerships',\n\n\n  serves_dropouts.int_val AS 'serves_dropouts',\n\n  is_rural_district.bool_val AS 'is_rural_district'\n\n\nFROM proposals p\nJOIN proposals_funds pf ON pf.proposal_id = p.id AND pf.fund_id = 23\n\n\nLEFT JOIN proposal_attributes collaborative_partnerships ON collaborative_partnerships.proposal_id = p.id AND collaborative_partnerships.attribute_name = 'collaborative_partnerships'\n\n\n\nLEFT JOIN proposal_attributes serves_dropouts ON serves_dropouts.proposal_id = p.id AND serves_dropouts.attribute_name = 'serves_dropouts'\n\n\nLEFT JOIN proposal_attributes application_region_ids ON application_region_ids.proposal_id = p.id AND application_region_ids.attribute_name = 'application_region'\nLEFT JOIN institutions application_region ON application_region.id = application_region_ids.int_val\n\nLEFT JOIN proposal_attributes is_rural_district ON is_rural_district.proposal_id = p.id AND is_rural_district.attribute_name = 'is_rural_district'\n\n\n\nleft join tasks submitted\n  on submitted.proposal_id = p.id and submitted.task_type = 'swpk_plan_submit'\n    and submitted.id IN (\n      SELECT\n          max(tasks.id)\n      from tasks\n      where tasks.deleted = 0\n      group by `task_type`,  `proposal_id`, `duration_id`,\n       `institution_id`, `year_id`, `annual_plan_id`,\n        `cfad_id`, `user_id`, `fund_id`)\n\nleft join tasks approved\n  on  approved.proposal_id = p.id and approved.task_type = 'swpk_plan_approve'\n  and approved.id in (\n    select\n        max(tasks.id)\n      from tasks\n      where tasks.deleted = 0\n      group by  `task_type`, `proposal_id`, `duration_id`,\n       `institution_id`, `year_id`, `annual_plan_id`,\n        `cfad_id`, `user_id`, `fund_id`)\n\nwhere p.deleted = 0 AND p.`type` = 'plan'\n\n  )"}, {"Label": "swpk12_plan_forecasts", "Type": "view", "SQL": "(\n\n  SELECT\npa.id,\n\npa.attribute_name,\npa.effort_area_id,\nea.effort_area_type,\n\n\nea.duration_id,\n\npa.proposal_id,\n\npa.int_val\n\n#DISTINCT attribute_name\nFROM effort_areas ea\nJOIN proposal_attributes pa  ON ea.id = pa.effort_area_id\nWHERE ea.effort_area_type = 'plan_expenditure_forecasts'\n\n\n\n  )"}, {"Label": "swpk12_population_focus", "Type": "view", "SQL": "sectors"}, {"Label": "swpk12_proposal_attributes", "Type": "view", "SQL": "proposal_attributes"}, {"Label": "swpk12_review_status", "Type": "view", "SQL": "(\n\nSELECT\nt.id,\nt.task_type,\n(case when t.completed = 1 then \"Review Submitted\" ELSE \"Review Not Submitted\" END ) AS review_status,\nt.completed,\nt.user_id,\nt.proposal_id\n\n\nFROM tasks t\nWHERE t.task_type = 'swpk_application_review_submit' AND t.deleted = 0  AND t.id IN (\nselect\n   max(tasks.id)\nfrom tasks\ngroup by `task_type`, `proposal_id`, `duration_id`,\n       `institution_id`, `year_id`, `annual_plan_id`,\n        `cfad_id`, `user_id`, `fund_id`)\n\n  )"}, {"Label": "swpk12_target_industries", "Type": "view", "SQL": "sectors"}, {"Label": "swp_annual_report_status", "Type": "view", "SQL": "(\n\nSELECT\nsubmit.completed AS submitted,\nsubmit.duration_id,\n\nd.year_id,\nsubmit.proposal_id,\napprove.completed AS approved,\n(case\nwhen submit.completed = 0\n  then 'Unsubmitted'\nwhen approve.completed = 1\n  then 'Certified'\nwhen submit.completed = 1\n  then 'Submitted'\nELSE 'Unsubmitted' END ) AS annual_report_status\n\nFROM tasks submit\n\nLEFT JOIN tasks approve ON approve.proposal_id = submit.proposal_id\n  AND approve.duration_id = submit.duration_id\n  AND approve.task_type = 'swp_annual_report_approve'\n  AND approve.id IN (\n\n  SELECT\n  MAX(t.id)\n  FROM tasks t\n  WHERE deleted = 0\n  GROUP BY task_type, proposal_id, duration_id\n\n  )\n\nJOIN durations d ON d.id = submit.duration_id\n\nWHERE submit.task_type = 'swp_annual_report_submit'\nAND submit.id IN\n\n(SELECT\n  MAX(t.id)\nFROM tasks t\nWHERE deleted = 0 and report_id is not null\nGROUP BY task_type, proposal_id, duration_id, report_id\n)\n\n  )"}, {"Label": "swp_certifying_authority", "Type": "view", "SQL": "(\n\n  SELECT\n  urs.institution_id,\n\n  CONCAT (users.last_name, ', ', users.first_name) as contact_name,\n\n  users.email_address,\n  users.phone\n\nfrom users_role_scopes urs\njoin users on users.id = urs.user_id\nand urs.role_id = 19\n\n\n  )"}, {"Label": "swp_l", "Type": "model", "SQL": "no sql?"}, {"Label": "swp_l_accountability", "Type": "view", "SQL": "(\n\n\n select\n\nswp_institutions_dt.region,\nswp_institutions_dt.district,\nswp_institutions_dt.name as institution,\nip.institution_id,\nip.proposal_id,\np.title as project_title,\nd.id as duration_id,\nyears.name as 'year',\nd.quarter,\np.state_id,\nstates.name as project_status,\ncase when swp_annual_report_approve.completed is null\nand p.state_id in (4, 15, 16, 17, 18)\nthen 0\nelse swp_annual_report_approve.completed\nend as 'expenditure_certification',\ncase when fr.submitted is null\n  and p.state_id in (4, 15, 16, 17, 18)\n  then 0\n  else fr.submitted\n  end as submitted,\nfr.id as fr_id,\ncontact_19.approver_institution,\ncontact_19.contact_name as certifying_authority,\ncontact_19.contact_title as certifying_authority_title,\ncontact_19.email_address as certifying_authority_email,\ncontact_19.phone  as certifying_authority_phone,\ncontact_22.name as lead_contact,\ncontact_22.title as lead_title,\ncontact_22.email_address as lead_email,\ncontact_22.phone as lead_phone\n\nfrom proposals_institutions ip\njoin years\njoin swp_institutions_dt\n  on swp_institutions_dt.id = ip.institution_id\njoin proposals p on p.id = ip.proposal_id\njoin states on states.id = p.state_id\njoin proposals_funds pf\non pf.proposal_id = ip.proposal_id\nand pf.fund_id = 2\njoin durations d on d.`type` = 'quarter'\nand d.year_id > p.year_id\nand d.year_id = years.id\n\n\nleft join fiscal_reports fr\non fr.institution_id = ip.institution_id\nand fr.proposal_id = ip.proposal_id\nand fr.duration_id = d.id\nand p.state_id in (4, 15, 16, 17, 18)\n\nleft join (\n\n  select  urs.institution_id as approver_id,  i.name as approver_institution,\n        concat (users.first_name, ' ', users.last_name ) as contact_name,\n        users.title as contact_title, users.email_address, users.phone\n\n  from users_role_scopes urs\n  join users on users.id = urs.user_id\n  and urs.role_id = 19\n  join institutions i on i.id = urs.institution_id\n\n\n) as contact_19 on contact_19.approver_id = p.approver_institution_id\n\nleft join (\n\nselect\n  users.id,\n  urs.institution_id,\n  urs.proposal_id,\n  concat (users.first_name, ' ', users.last_name ) as name,\n        users.title, users.email_address, users.phone\n  from users_role_scopes urs\n  join users on users.id = urs.user_id\n  and urs.role_id = 22\n\n)  as contact_22 on contact_22.institution_id = ip.institution_id\n  and contact_22.proposal_id = ip.proposal_id\n\nleft join (\n  select\n   completed\n   , proposal_id\n   , durations.year_id\n  from tasks\n  join durations on durations.id = tasks.duration_id\n  where tasks.id in (\n    select\n        max(tasks.id)\n      from tasks\n      where task_type = 'swp_annual_report_approve'\n      group by `task_type`, `proposal_id`, `duration_id`,\n       `institution_id`, `year_id`, `annual_plan_id`,\n        `cfad_id`, `user_id`, `fund_id`\n      )\n  ) as swp_annual_report_approve\n\non swp_annual_report_approve.year_id = years.id\nand swp_annual_report_approve.proposal_id = ip.proposal_id\n\nwhere\np.deleted = 0\nand years.id < 2021\n\n\n\n  )"}, {"Label": "financial_reporting", "Type": "explore", "SQL": "no sql?"}, {"Label": "swp_l_allocations", "Type": "orphan", "SQL": "(\n\nselect\n\n\n   swp_institutions_dt.name as institution\n  , swp_institutions_dt.district\n  , swp_institutions_dt.region\n  , years.name as year\n  , certified_budget_dt.certified_budget\n  , fiscal_reports_dt.annual_expenditure\n\n, sum(allocations.amount) as district_allocations\n\n\n\nfrom swp_institutions_dt\njoin institutions districts\n  on districts.name = swp_institutions_dt.district\n\n\njoin years\n\njoin\n(select\nbi.year_id,\nbi.institution_id,\nsum(bi.amount) as certified_budget\n\nfrom budget_items bi\njoin proposals p\non p.id = bi.proposal_id\n\nwhere p.state_id = 4\nand bi.fund_id = 2\n\ngroup by bi.year_id, bi.institution_id ) as certified_budget_dt\n\non certified_budget_dt.institution_id = swp_institutions_dt.id\nand certified_budget_dt.year_id = years.id\n\n\n\njoin\n(\n\nselect\n\nfiscal_reports.institution_id,\ndurations.year_id,\n\nsum(fiscal_report_lines.amount) as annual_expenditure\n\nfrom fiscal_reports\njoin fiscal_report_lines on fiscal_report_lines.fiscal_report_id = fiscal_reports.id\nand fiscal_reports.fund_id = 2\njoin durations on durations.id = fiscal_reports.duration_id\nwhere durations.`type` = 'quarter'\ngroup by durations.year_id, fiscal_reports.institution_id\n\n) as fiscal_reports_dt\n\non fiscal_reports_dt.institution_id = swp_institutions_dt.id\n\nand fiscal_reports_dt.year_id = years.id\n\njoin allocations\n  on allocations.to_institution_id = districts.id\n  and allocations.year_id = years.id\n  and allocations.fund_id = 2\n\ngroup by swp_institutions_dt.name , swp_institutions_dt.district  , swp_institutions_dt.region  , years.name\n\n\n      )"}, {"Label": "project_details", "Type": "explore", "SQL": "no sql?"}, {"Label": "swp_l_project_details", "Type": "orphan", "SQL": "(\n  select\n  proposals.id as project_id\n  , proposals.title as project_title\n  , proposals.description\n  , funds.name as funding_source\n  , swp_institutions_dt.name as institution\n  , lead_dt.lead_institution\n  , swp_institutions_dt.district as district\n  , swp_institutions_dt.region as region\n  , years.name as year\n  , lmi_dt.TOP_value\n  , lmi_dt.SOC_value\n  , lmi_dt.top6_code\n  , lmi_dt.soc_code\n  , sector_dt.Sector\n\nfrom proposals_institutions\njoin swp_institutions_dt on swp_institutions_dt.id = proposals_institutions.institution_id\nleft join proposals_funds on proposals_funds.proposal_id = proposals_institutions.proposal_id\nleft join funds on funds.id = proposals_funds.fund_id\nleft join proposals on proposals.id = proposals_institutions.proposal_id\njoin years on years.id = proposals.year_id\n\nLEFT JOIN (\n\nSELECT lmi_programs.id as lmi_program_id, lmi_programs.lmi_id, lmi_programs.institution_id, lmis.proposal_id, top6_dt.TOP_value, top6_dt.top6_code, soc_dt.SOC_value, soc_dt.soc_code\n\nFROM lmi_programs\nLEFT JOIN\n  (SELECT value as TOP_value, code as top6_code, id as top_code_id FROM codes\n  WHERE `type` = 'top6_code' ) as top6_dt\nON top6_dt.top_code_id = lmi_programs.top6_code_id\n\nLEFT JOIN (\n  SELECT lmi_soc_codes.lmi_id, lmi_soc_codes.soc_code_id, codes.code as soc_code, codes.value as SOC_value\n  FROM lmi_soc_codes\n  JOIN codes on codes.id = lmi_soc_codes.soc_code_id\n  WHERE codes.`type` = 'soc_code'\n  ) AS soc_dt\nON soc_dt.lmi_id = lmi_programs.lmi_id\n\nLEFT JOIN lmis\n  ON lmis.id = lmi_programs.lmi_id\n\n) AS lmi_dt\nON lmi_dt.institution_id = proposals_institutions.institution_id\nAND lmi_dt.proposal_id = proposals_institutions.proposal_id\n\n\n\nleft join(\n  select\n    proposals.id,\n    institutions.name as lead_institution\n  from proposals\n  join institutions on institutions.id = proposals.approver_institution_id\n  ) as lead_dt on lead_dt.id = proposals_institutions.proposal_id\n\n\nLEFT JOIN (\nSELECT proposals_sectors.proposal_id, sectors.name as Sector\nFROM proposals_sectors\nLEFT JOIN sectors ON sectors.id = proposals_sectors.sector_id\n) AS sector_dt\n\nON  sector_dt.proposal_id = proposals_institutions.proposal_id\n\nwhere\n  proposals_funds.fund_id = 2\nand\n  proposals.deleted = 0\n)"}, {"Label": "swp_project_budget", "Type": "view", "SQL": "(\n\nSELECT\nip.id AS proposals_institutions_id,\nbi.object_code_id,\nbi.id,\nSUM(bi.amount) as project_budget\nFROM budget_items bi\nJOIN proposals_institutions ip ON ip.institution_id = bi.institution_id AND ip.proposal_id = bi.proposal_id\nGROUP BY ip.id, bi.object_code_id\n  )"}, {"Label": "swp_r", "Type": "model", "SQL": "no sql?"}, {"Label": "swp_r_accountability", "Type": "view", "SQL": "(\n\n select\n\nswp_institutions_dt.region,\nswp_institutions_dt.district,\nswp_institutions_dt.name as institution,\nip.institution_id,\nip.proposal_id,\np.title as project_title,\nd.id as duration_id,\nyears.name as 'year',\nd.quarter,\np.state_id,\nstates.name as project_status,\ncase when swp_annual_report_approve.completed is null\nand p.state_id in (4, 15, 16, 17, 18)\nthen 0\nelse swp_annual_report_approve.completed\nend as 'expenditure_certification',\ncase when fr.submitted is null\n  and p.state_id in (4, 15, 16, 17, 18)\n  then 0\n  else fr.submitted\n  end as submitted,\nfr.id as fr_id,\ncontact_19.approver_institution,\ncontact_19.contact_name as certifying_authority,\ncontact_19.contact_title as certifying_authority_title,\ncontact_19.email_address as certifying_authority_email,\ncontact_19.phone  as certifying_authority_phone,\ncontact_22.name as lead_contact,\ncontact_22.title as lead_title,\ncontact_22.email_address as lead_email,\ncontact_22.phone as lead_phone\n\nfrom proposals_institutions ip\njoin years\njoin swp_institutions_dt\n  on swp_institutions_dt.id = ip.institution_id\njoin proposals p on p.id = ip.proposal_id\njoin states on states.id = p.state_id\njoin proposals_funds pf\non pf.proposal_id = ip.proposal_id\nand pf.fund_id = 1\njoin durations d on d.`type` = 'quarter'\nand d.year_id > p.year_id\nand d.year_id = years.id\n\n\nleft join fiscal_reports fr\non fr.institution_id = ip.institution_id\nand fr.proposal_id = ip.proposal_id\nand fr.duration_id = d.id\nand p.state_id in (4, 15, 16, 17, 18)\n\nleft join (\n\n  select  urs.institution_id as approver_id,  i.name as approver_institution,\n        concat (users.first_name, ' ', users.last_name ) as contact_name,\n        users.title as contact_title, users.email_address, users.phone\n\n  from users_role_scopes urs\n  join users on users.id = urs.user_id\n  and urs.role_id = 19\n  join institutions i on i.id = urs.institution_id\n\n\n) as contact_19 on contact_19.approver_id = p.approver_institution_id\n\nleft join (\n\nselect\n  users.id,\n  urs.institution_id,\n  urs.proposal_id,\n  concat (users.first_name, ' ', users.last_name ) as name,\n        users.title, users.email_address, users.phone\n  from users_role_scopes urs\n  join users on users.id = urs.user_id\n  and urs.role_id = 22\n\n)  as contact_22 on contact_22.institution_id = ip.institution_id\n  and contact_22.proposal_id = ip.proposal_id\n\nleft join (\n  select\n   completed\n   , proposal_id\n   , durations.year_id\n  from tasks\n  join durations on durations.id = tasks.duration_id\n  where tasks.id in (\n    select\n        max(tasks.id)\n      from tasks\n      where task_type = 'swp_annual_report_approve'\n      group by `task_type`, `proposal_id`, `duration_id`,\n       `institution_id`, `year_id`, `annual_plan_id`,\n        `cfad_id`, `user_id`, `fund_id`\n      )\n  ) as swp_annual_report_approve\n\non swp_annual_report_approve.year_id = years.id\nand swp_annual_report_approve.proposal_id = ip.proposal_id\n\nwhere\np.deleted = 0\nand years.id < 2021\n\n\n\n  )"}, {"Label": "swp_r_allocations", "Type": "view", "SQL": "(\n\n    select\n\n\n       swp_institutions_dt.name as institution\n      , swp_institutions_dt.district\n      , swp_institutions_dt.region\n      , years.name as year\n      , certified_budget_dt.certified_budget\n      , fiscal_reports_dt.annual_expenditure\n      , sum(allocations.amount) as regional_allocations\n\n\n\n    from swp_institutions_dt\n    join institutions regions\n      on regions.name = swp_institutions_dt.region\n      and regions.`type` = 'RC'\n\n    join years\n\n    join (\n      select\n        bi.year_id,\n        bi.institution_id,\n        sum(bi.amount) as certified_budget\n\n      from budget_items bi\n      join proposals p\n      on p.id = bi.proposal_id\n\n      where p.state_id = 4\n      and bi.fund_id = 1\n\n      group by bi.year_id, bi.institution_id\n\n    ) as certified_budget_dt\n    on certified_budget_dt.institution_id = swp_institutions_dt.id\n    and certified_budget_dt.year_id = years.id\n\n    join (\n\n      select\n\n        fiscal_reports.institution_id,\n        durations.year_id,\n        sum(fiscal_report_lines.amount) as annual_expenditure\n\n      from fiscal_reports\n      join fiscal_report_lines on fiscal_report_lines.fiscal_report_id = fiscal_reports.id\n      and fiscal_reports.fund_id = 1\n      join durations on durations.id = fiscal_reports.duration_id\n      where durations.`type` = 'quarter'\n      group by durations.year_id, fiscal_reports.institution_id\n\n    ) as fiscal_reports_dt\n\n    on fiscal_reports_dt.institution_id = swp_institutions_dt.id\n\n    and fiscal_reports_dt.year_id = years.id\n\n    join allocations\n      on allocations.to_institution_id = regions.id\n      and allocations.year_id = years.id\n      and allocations.fund_id = 1\n\n    group by swp_institutions_dt.name , swp_institutions_dt.district  , swp_institutions_dt.region  , years.name\n\n    )"}, {"Label": "swp_r_financial_reporting", "Type": "orphan", "SQL": "(\n\n  select\n  proposals.id as project_id\n  , proposals.title as project_title\n  , swp_institutions_dt.name as institution\n  , swp_institutions_dt.district\n  , swp_institutions_dt.region\n  , years.name as year\n, budget_dt.amount as annual_budget\n, budget_dt.id as budget_items_id\n, (budget_dt.percent * budget_dt.amount)/100 as 'quarterly_forecast'\n, fiscal_reports_dt.amount as expenditure_amount\n, fiscal_reports_dt.submitted as report_submission_status\n, budget_dt.quart\n, object_codes.name as object_code\n, swp_annual_report_approve.completed as expenditure_certification\n, states.name as 'project_certification'\n\nfrom proposals_institutions\njoin years\njoin swp_institutions_dt on swp_institutions_dt.id = proposals_institutions.institution_id\njoin proposals_funds on proposals_funds.proposal_id = proposals_institutions.proposal_id\nand proposals_funds.fund_id = 1\njoin proposals on proposals.id = proposals_institutions.proposal_id\njoin states on states.id = proposals.state_id\njoin object_codes\n\nleft join (\n\nselect id, object_code_id, proposal_id, amount, budget_id, institution_id, year_id, fund_id, '1' quart, quarter_1 percent\nfrom budget_items\nunion all\nselect id, object_code_id, proposal_id, amount, budget_id, institution_id, year_id, fund_id, '2' quart, quarter_2 percent\nfrom budget_items\nunion all\nselect id, object_code_id, proposal_id, amount, budget_id, institution_id, year_id, fund_id, '3' quart, quarter_3 percent\nfrom budget_items\nunion all\nselect id, object_code_id, proposal_id, amount, budget_id, institution_id, year_id, fund_id, '4' quart, quarter_4 percent\nfrom budget_items\n)\n\nas budget_dt\n  on budget_dt.proposal_id = proposals_institutions.proposal_id\n  and budget_dt.institution_id = proposals_institutions.institution_id\n  and budget_dt.year_id = years.id\n  and budget_dt.object_code_id = object_codes.id\n\nleft join (\nselect\nfiscal_reports.proposal_id,\nfiscal_reports.duration_id,\nfiscal_reports.institution_id,\nfiscal_reports.submitted,\ndurations.year_id,\ndurations.`quarter`,\nfiscal_report_lines.amount,\nfiscal_report_lines.object_code_id\n\nfrom fiscal_reports\njoin fiscal_report_lines on fiscal_report_lines.fiscal_report_id = fiscal_reports.id\nand fiscal_reports.fund_id = 1\njoin durations on durations.id = fiscal_reports.duration_id\nwhere durations.`type` = 'quarter'\n\n) as fiscal_reports_dt\non fiscal_reports_dt.proposal_id = proposals_institutions.proposal_id\nand fiscal_reports_dt.institution_id = proposals_institutions.institution_id\nand fiscal_reports_dt.year_id = years.id\nand fiscal_reports_dt.`quarter` = budget_dt.quart\nand fiscal_reports_dt.object_code_id = object_codes.id\n\n\nleft join (\nselect\ncompleted\n, proposal_id\n, durations.year_id\nfrom tasks\njoin durations on durations.id = tasks.duration_id\nwhere tasks.id in (\nselect\nmax(tasks.id)\nfrom tasks\nwhere task_type = 'swp_annual_report_approve'\ngroup by `task_type`, `proposal_id`, `duration_id`,\n`institution_id`, `year_id`, `annual_plan_id`,\n`cfad_id`, `user_id`, `fund_id`\n)\n) as swp_annual_report_approve on\nswp_annual_report_approve.year_id = years.id\nand swp_annual_report_approve.proposal_id = proposals_institutions.proposal_id\n\n\nwhere\n  proposals_funds.fund_id = 1\nand\n  proposals.deleted = 0\nand\n(budget_dt.amount is not null\nor\n  fiscal_reports_dt.amount is not null)\n\n)"}, {"Label": "swp_r_project_details", "Type": "orphan", "SQL": "(\n\n  select\n  proposals.id as project_id\n  , proposals.title as project_title\n  , proposals.description\n  , funds.name as funding_source\n  , swp_institutions_dt.name as institution\n  , lead_dt.lead_institution\n  , swp_institutions_dt.district as district\n  , swp_institutions_dt.region as region\n  , years.name as year\n  , lmi_dt.TOP_value\n  , lmi_dt.SOC_value\n  , lmi_dt.top6_code\n  , lmi_dt.soc_code\n  , sector_dt.Sector\n\nfrom proposals_institutions\njoin swp_institutions_dt on swp_institutions_dt.id = proposals_institutions.institution_id\nleft join proposals_funds on proposals_funds.proposal_id = proposals_institutions.proposal_id\nleft join funds on funds.id = proposals_funds.fund_id\nleft join proposals on proposals.id = proposals_institutions.proposal_id\njoin years on years.id = proposals.year_id\n\nLEFT JOIN (\n\nSELECT lmi_programs.id as lmi_program_id, lmi_programs.lmi_id, lmi_programs.institution_id, lmis.proposal_id, top6_dt.TOP_value, top6_dt.top6_code, soc_dt.SOC_value, soc_dt.soc_code\n\nFROM lmi_programs\nLEFT JOIN\n  (SELECT value as TOP_value, code as top6_code, id as top_code_id FROM codes\n  WHERE `type` = 'top6_code' ) as top6_dt\nON top6_dt.top_code_id = lmi_programs.top6_code_id\n\nLEFT JOIN (\n  SELECT lmi_soc_codes.lmi_id, lmi_soc_codes.soc_code_id, codes.code as soc_code, codes.value as SOC_value\n  FROM lmi_soc_codes\n  JOIN codes on codes.id = lmi_soc_codes.soc_code_id\n  WHERE codes.`type` = 'soc_code'\n  ) AS soc_dt\nON soc_dt.lmi_id = lmi_programs.lmi_id\n\nLEFT JOIN lmis\n  ON lmis.id = lmi_programs.lmi_id\n\n) AS lmi_dt\nON lmi_dt.institution_id = proposals_institutions.institution_id\nAND lmi_dt.proposal_id = proposals_institutions.proposal_id\n\n\n\nleft join(\n  select\n    proposals.id,\n    institutions.name as lead_institution\n  from proposals\n  join institutions on institutions.id = proposals.approver_institution_id\n  ) as lead_dt on lead_dt.id = proposals_institutions.proposal_id\n\n\nLEFT JOIN (\nSELECT proposals_sectors.proposal_id, sectors.name as Sector\nFROM proposals_sectors\nLEFT JOIN sectors ON sectors.id = proposals_sectors.sector_id\n) AS sector_dt\n\nON  sector_dt.proposal_id = proposals_institutions.proposal_id\n\nwhere\n  proposals_funds.fund_id = 1\nand\n  proposals.deleted = 0\n)"}], "connections": [{"To": "AEBG", "From": "aebg_allocations", "sql_on": "NA", "fields": "NA"}, {"To": "AEBG", "From": "aebg_financial_reporting", "sql_on": "NA", "fields": "NA"}, {"To": "AEBG", "From": "caep", "sql_on": "NA", "fields": "NA"}, {"To": "aebg_allocations", "From": "aebg_allocations", "sql_on": "NA", "fields": "all"}, {"To": "aebg_financial_reporting", "From": "aebg_financial_reporting", "sql_on": "NA", "fields": "all"}, {"To": "caep", "From": "proposals_institutions_funds_durations_object_codes", "sql_on": "NA", "fields": "all"}, {"To": "caep", "From": "caep_institutions_dt", "sql_on": "${caep.proposals_institutions_id} = ${caep_institutions_dt.member_proposal_id} and ${caep.year_id} = ${caep_institutions_dt.year_id} and ${caep.fund_id} = 3 and ${caep.duration_type} = 'quarter'", "fields": "all"}, {"To": "caep", "From": "caep_cfads", "sql_on": "${caep_cfads.proposal_id} = ${caep.proposal_id} and ${caep_cfads.year_id} = ${caep.year_id}", "fields": "all"}, {"To": "caep", "From": "fiscal_agents", "sql_on": "${caep_cfads.fiscal_agent_id} = ${fiscal_agents.institution_id}", "fields": "all"}, {"To": "caep", "From": "states", "sql_on": "${caep_cfads.state_id} = ${states.state_id}", "fields": ["states.cfad_status"]}, {"To": "caep", "From": "all_role_scopes", "sql_on": "${consortia_roles_scopes.institution_id} = ${caep_institutions_dt.consortium_id}", "fields": []}, {"To": "caep", "From": "all_users", "sql_on": "${consortia_contact.user_id} = ${consortia_roles_scopes.user_id}", "fields": ["consortia_contact.contact_fullname", "consortia_contact.email_address", "consortia_contact.phone_number", "consortia_contact.title"]}, {"To": "caep", "From": "roles", "sql_on": "${consortia_roles.role_id} = ${consortia_roles_scopes.role_id}", "fields": ["consortia_roles.role"]}, {"To": "caep", "From": "caep_strategies", "sql_on": "${strategies.proposals_institutions_id} = ${caep.proposals_institutions_id}", "fields": "all"}, {"To": "caep", "From": "caep_annual_plan_status", "sql_on": "${annual_plan.annual_plan_id} = ${strategies.annual_plan_id}", "fields": "all"}, {"To": "caep", "From": "caep_program_area_reports", "sql_on": "${program_area_reports.proposals_institutions_id} = ${caep.proposals_institutions_id}", "fields": "all"}, {"To": "caep", "From": "caep_program_area_report_lines", "sql_on": "${program_area_report_lines.program_area_report_id} = ${program_area_reports.program_area_report_id}", "fields": "all"}, {"To": "caep", "From": "all_years", "sql_on": "${caep.year_id} = ${all_years.year_id}", "fields": "all"}, {"To": "caep", "From": "all_fiscal_reports_lines", "sql_on": "${fiscal_reports.proposals_institutions_id} = ${caep.proposals_institutions_id} and ${fiscal_reports.duration_id} = ${caep.duration_id} and ${fiscal_reports.object_code_id} = ${caep.object_code_id}", "fields": "all"}, {"To": "caep", "From": "budgets_unpivoted", "sql_on": "${budgets.proposals_institutions_id} = ${caep.proposals_institutions_id} and ${budgets.duration_id} = ${caep.duration_id} and ${budgets.object_code_id} = ${caep.object_code_id}", "fields": "all"}, {"To": "caep", "From": "all_allocations", "sql_on": "${consortium_allocations.to_institution_id} = ${caep_institutions_dt.consortium_id} and ${consortium_allocations.allocation_year} = ${caep_institutions_dt.year_id} and ${consortium_allocations.fund_id} = 3", "fields": ["consortium_allocations.Consortium_Allocations"]}, {"To": "CAI", "From": "cai_applications", "sql_on": "NA", "fields": "NA"}, {"To": "cai_applications", "From": "cai_state_allocations", "sql_on": "NA", "fields": "all"}, {"To": "cai_applications", "From": "cai_details", "sql_on": "${cai_applications.fund_id} = ${cai.fund_id}", "fields": "all"}, {"To": "cai_applications", "From": "cai_apprentice_ratio", "sql_on": "${cai.proposal_id} = ${ratio.proposal_id}", "fields": "all"}, {"To": "cai_applications", "From": "cai_application_status", "sql_on": "${status.proposal_id} = ${cai.proposal_id}", "fields": "all"}, {"To": "cai_applications", "From": "all_project_lead", "sql_on": "${cai.proposal_id} = ${project_lead.proposal_id}", "fields": "all"}, {"To": "cai_applications", "From": "all_lead_institution", "sql_on": "${cai.proposal_id} = ${lead_agency.proposal_id}", "fields": "all"}, {"To": "cai_applications", "From": "cai_agency_contributions", "sql_on": "${cai.proposals_institutions_id} = ${agency_contributions.proposals_institutions_id}", "fields": "all"}, {"To": "cai_applications", "From": "all_role_scopes", "sql_on": "${role_scopes.proposal_id} = ${cai.proposal_id} and ${role_scopes.institution_id} = ${cai.institution_id}", "fields": []}, {"To": "cai_applications", "From": "all_users", "sql_on": "${users.user_id} = ${role_scopes.user_id}", "fields": ["contact_name", "email_address", "phone_number"]}, {"To": "cai_applications", "From": "cai_plan_budget", "sql_on": "${cai.proposals_institutions_id} = ${budget.proposals_insitutions_id}", "fields": "all"}, {"To": "cai_applications", "From": "cai_soc_codes", "sql_on": "${cai.proposal_id} = ${soc_codes.proposal_id}", "fields": "all"}, {"To": "cai_applications", "From": "cai_journeyman_wages", "sql_on": "${soc_codes.effort_area_id} = ${journeyman_wages.effort_area_id}", "fields": "all"}, {"To": "cai_applications", "From": "cai_curriculum_topics", "sql_on": "${soc_codes.effort_area_id} = ${curriculum.parent_effort_area_id}", "fields": "all"}, {"To": "cai_applications", "From": "cai_proposal_attributes", "sql_on": "${soc_codes.effort_area_id} = ${apprenticeship_attributes.effort_area_id}", "fields": "all"}, {"To": "cai_applications", "From": "cai_work_processes", "sql_on": "${soc_codes.effort_area_id} = ${work_processes.parent_effort_area_id}", "fields": "all"}, {"To": "cai_applications", "From": "cai_objectives", "sql_on": "${objectives.proposal_id} = ${cai.proposal_id} and ${objectives.effort_area_type} = \"workplan_objectives\"", "fields": "all"}, {"To": "cai_applications", "From": "cai_workplan_activities", "sql_on": "${objectives.effort_area_id} = ${activities.objective_ea_id} and ${budget.activity_effort_area_id} = ${activities.effort_area_id}", "fields": "all"}, {"To": "cai_applications", "From": "cai_workplan_outcomes", "sql_on": "${outcomes.objective_ea_id} = ${objectives.effort_area_id}", "fields": "all"}, {"To": "cai_applications", "From": "cai_need", "sql_on": "${cai.proposal_id} = ${need.proposal_id}", "fields": "all"}, {"To": "cai_applications", "From": "cai_trained_geo", "sql_on": "${cai.proposal_id} = ${trained_geo.proposal_id}", "fields": "all"}, {"To": "cai_applications", "From": "cai_paid_geo", "sql_on": "${cai.proposal_id} = ${paid_geo.proposal_id}", "fields": "all"}, {"To": "GP", "From": "guided_pathways", "sql_on": "NA", "fields": "NA"}, {"To": "guided_pathways", "From": "ALL_proposals_institutions_names_funds", "sql_on": "NA", "fields": ["ALL_FIELDS*", "-proposal_start_date", "-proposal_end_date"]}, {"To": "guided_pathways", "From": "all_years", "sql_on": "cross", "fields": "all"}, {"To": "guided_pathways", "From": "gp_status", "sql_on": "${gp_status.proposal_id} = ${guided_pathways.proposal_id}", "fields": "all"}, {"To": "guided_pathways", "From": "all_project_lead", "sql_on": "${all_project_lead.proposal_id} = ${guided_pathways.proposal_id} and ${all_project_lead.fund_id} = ${guided_pathways.fund_id}", "fields": ["all_project_lead.contact_name", "all_project_lead.contact_title", "all_project_lead.email_address", "all_project_lead.phone_number"]}, {"To": "guided_pathways", "From": "ALL_budget_object_codes", "sql_on": "${gp_budgets.proposal_id} = ${guided_pathways.proposal_id} and ${gp_budgets.fund_id} = ${guided_pathways.fund_id} and ${gp_budgets.budget_year} = ${years.year_id}", "fields": "all"}, {"To": "guided_pathways", "From": "all_allocations", "sql_on": "${gp_allocations.to_institution_id} = ${guided_pathways.institution_id} and ${gp_allocations.fund_id} = ${guided_pathways.fund_id} and ${gp_allocations.allocation_year} = ${years.year_id}", "fields": "all"}, {"To": "guided_pathways", "From": "gp_workplans", "sql_on": "${gp_workplans.proposal_id} = ${guided_pathways.proposal_id}", "fields": "all"}, {"To": "guided_pathways", "From": "gp_wp_unpivoted", "sql_on": "${gp_wp_unpivoted.wpi_id} = ${gp_workplans.workplan_id}", "fields": "all"}, {"To": "LVG", "From": "local_vision_goals", "sql_on": "NA", "fields": "NA"}, {"To": "local_vision_goals", "From": "ALL_proposals_institutions_names_funds", "sql_on": "NA", "fields": ["ALL_FIELDS*", "-proposal_start_date", "-proposal_end_date"]}, {"To": "local_vision_goals", "From": "lvg_proposal_status", "sql_on": "${local_vision_goals.proposal_id} = ${lvg_proposal_status.proposal_id}", "fields": "all"}, {"To": "local_vision_goals", "From": "lvg_baseline_metrics", "sql_on": "${lvg_baseline_metrics.institution_id} = ${local_vision_goals.institution_id}", "fields": "all"}, {"To": "local_vision_goals", "From": "lvg_target_metrics", "sql_on": "${lvg_target_metrics.proposal_id} = ${local_vision_goals.proposal_id}\n    and ${lvg_target_metrics.metric_definition_id} = ${lvg_baseline_metrics.metric_definition_id}\n    and ${lvg_target_metrics.impacted_group_id} = ${lvg_baseline_metrics.impacted_group_id}", "fields": "all"}, {"To": "local_vision_goals", "From": "lvg_metrics_digs", "sql_on": "${lvg_baseline_metrics.impacted_group_id} = ${lvg_metrics_digs.impacted_group_id}\n    and ${lvg_baseline_metrics.metric_definition_id} = ${lvg_metrics_digs.metric_definition_id}", "fields": "all"}, {"To": "NOVA_Users", "From": "nova_users", "sql_on": "NA", "fields": "NA"}, {"To": "nova_users", "From": "all_users", "sql_on": "NA", "fields": ["ALL_FIELDS*", "-nova_users.contact_name", "-nova_users.name"]}, {"To": "nova_users", "From": "job_categories", "sql_on": "${job_categories.job_category_id} = ${nova_users.job_category_id}", "fields": "all"}, {"To": "nova_users", "From": "all_institutions_dt", "sql_on": "${role_institution.institution_id} = ${all_role_scopes.institution_id}", "fields": "all"}, {"To": "nova_users", "From": "all_role_scopes", "sql_on": "${all_role_scopes.user_id} = ${nova_users.user_id}", "fields": "all"}, {"To": "nova_users", "From": "roles", "sql_on": "${roles.role_id} = ${all_role_scopes.role_id}", "fields": "all"}, {"To": "nova_users", "From": "funds", "sql_on": "${funds.fund_id} = ${all_role_scopes.fund_id}", "fields": "all"}, {"To": "nova_users", "From": "all_lead_institution", "sql_on": "${all_lead_institution.proposal_id} = ${all_role_scopes.proposal_id}", "fields": "all"}, {"To": "SEP", "From": "sep", "sql_on": "NA", "fields": "NA"}, {"To": "sep", "From": "ALL_proposals_institutions_names_funds", "sql_on": "NA", "fields": ["ALL_FIELDS*", "-proposal_start_date", "-proposal_end_date"]}, {"To": "sep", "From": "sep_targets", "sql_on": "${targets.proposal_id} = ${sep.proposal_id}", "fields": "all"}, {"To": "sep", "From": "sep_baselines", "sql_on": "${baselines.institution_id} = ${sep.institution_id}\n          and ${targets.metric_definition_id} = ${baselines.metric_definition_id}\n      and ${targets.impacted_group_id} = ${baselines.impacted_group_id}\n      and ${targets.gender_id} = ${baselines.gender_id}", "fields": "all"}, {"To": "sep", "From": "sep_related_metrics", "sql_on": "${related_activites.effort_area_id} = ${targets.effort_area_id}", "fields": "all"}, {"To": "sep", "From": "sep_narrative_fields", "sql_on": "${success_criteria.proposal_id} = ${sep.proposal_id} and ${success_criteria.attribute_name} = 'success_criteria'", "fields": ["success_criteria.success_criteria"]}, {"To": "sep", "From": "all_project_lead", "sql_on": "${project_lead_contact.proposal_id} = ${sep.proposal_id}", "fields": "all"}, {"To": "sep", "From": "sep_proposal_status", "sql_on": "${status.proposal_id} = ${sep.proposal_id}", "fields": "all"}, {"To": "sep", "From": "sep_executive_summary", "sql_on": "${summary_link.proposal_id} = ${sep.proposal_id}", "fields": "all"}, {"To": "SWPk12", "From": "swpk12_loi", "sql_on": "NA", "fields": "NA"}, {"To": "SWPk12", "From": "swpk12_project_details", "sql_on": "NA", "fields": "NA"}, {"To": "SWPk12", "From": "plans", "sql_on": "NA", "fields": "NA"}, {"To": "swpk12_loi", "From": "swpk12_loi_details", "sql_on": "NA", "fields": "all"}, {"To": "swpk12_loi", "From": "swpk12_lead_agency", "sql_on": "${swpk12_lead_agency.proposal_id} = ${swpk12_loi.proposal_id}", "fields": "all"}, {"To": "swpk12_loi", "From": "swpk12_agency_contributions", "sql_on": "${swpk12_loi.proposal_id} = ${swpk12_agency_contributions.proposal_id}", "fields": ["ada_number", "Total_ADA", "partner_agency", "partner_agencies", "institution_count"]}, {"To": "swpk12_loi", "From": "swpk12_proposal_attributes", "sql_on": "${swpk12_loi.proposal_id} = ${swpk12_proposal_attributes.proposal_id}", "fields": "all"}, {"To": "swpk12_loi", "From": "swpk12_population_focus", "sql_on": "${swpk12_proposal_attributes.attributes_ids} = ${swpk12_population_focus.sectors_id} and ${swpk12_proposal_attributes.attribute_name} = 'pf_sectors'", "fields": "all"}, {"To": "swpk12_loi", "From": "swpk12_target_industries", "sql_on": "${swpk12_proposal_attributes.attributes_ids} = ${swpk12_target_industries.sector_id} and ${swpk12_proposal_attributes.attribute_name} = 'cde_sectors'", "fields": "all"}, {"To": "swpk12_project_details", "From": "swpk12_project_details", "sql_on": "NA", "fields": "all"}, {"To": "swpk12_project_details", "From": "swpk12_lead_agency", "sql_on": "${swpk12_lead_agency.proposal_id} = ${swpk12_project_details.proposal_id}", "fields": "all"}, {"To": "swpk12_project_details", "From": "swpk12_agency_contributions", "sql_on": "${swpk12_project_details.proposal_id} = ${swpk12_agency_contributions.proposal_id}", "fields": "all"}, {"To": "swpk12_project_details", "From": "ALL_budget_object_codes", "sql_on": "${swpk12_project_details.proposal_id} = ${ALL_budget_object_codes.proposal_id} and ${ALL_budget_object_codes.fund_id}=23", "fields": "all"}, {"To": "swpk12_project_details", "From": "swpk12_proposal_attributes", "sql_on": "${swpk12_project_details.proposal_id} = ${swpk12_proposal_attributes.proposal_id}", "fields": "all"}, {"To": "swpk12_project_details", "From": "swpk12_impacted_groups", "sql_on": "${swpk12_proposal_attributes.attributes_ids} = ${swpk12_impacted_groups.impacted_group_id} and ${swpk12_proposal_attributes.attribute_name} = 'impacted_groups'", "fields": "all"}, {"To": "swpk12_project_details", "From": "swpk12_population_focus", "sql_on": "${swpk12_proposal_attributes.attribute_name} = 'pf_sectors' and ${swpk12_proposal_attributes.attributes_ids} = ${swpk12_population_focus.sectors_id}", "fields": "all"}, {"To": "swpk12_project_details", "From": "swpk12_target_industries", "sql_on": "${swpk12_proposal_attributes.attributes_ids} = ${swpk12_target_industries.sector_id} and ${swpk12_proposal_attributes.attribute_name} = 'cde_sectors'", "fields": "all"}, {"To": "swpk12_project_details", "From": "all_role_scopes", "sql_on": "${contact_id.institution_id} = ${swpk12_agency_contributions.institution_id} and ${contact_id.proposal_id} = ${swpk12_agency_contributions.proposal_id} and ${contact_id.role_id} = 20", "fields": []}, {"To": "swpk12_project_details", "From": "all_users", "sql_on": "${contact_info.user_id} = ${contact_id.user_id}", "fields": ["contact_info.contact_name", "contact_info.email_address", "contact_info.phone_number"]}, {"To": "swpk12_project_details", "From": "all_resource_notes", "sql_on": "${review_scores.proposal_id} = ${swpk12_project_details.proposal_id} and ${review_scores.user_id} = ${all_users.user_id} and ${review_scores.type} = 'review' and ${review_scores.area_name} != 'budget-followup'", "fields": "all"}, {"To": "swpk12_project_details", "From": "swpk12_budget_followup", "sql_on": "${budget_followup.proposal_id} = ${swpk12_project_details.proposal_id} and ${budget_followup.user_id} = ${all_users.user_id}", "fields": "all"}, {"To": "swpk12_project_details", "From": "swpk12_review_status", "sql_on": "${swpk12_review_status.proposal_id} = ${swpk12_project_details.proposal_id} and ${swpk12_review_status.user_id} = ${all_users.user_id}", "fields": "all"}, {"To": "swpk12_project_details", "From": "swpk12_funding_status", "sql_on": "${funding_status.proposal_id} = ${swpk12_project_details.proposal_id}", "fields": "all"}, {"To": "plans", "From": "swpk12_plan_details", "sql_on": "NA", "fields": ["ALL_FIELDS*", "-partners.available_grant_funds"]}, {"To": "plans", "From": "swpk12_plan_allocations", "sql_on": "${plans.proposal_id} = ${funding.to_proposal_id}", "fields": "all"}, {"To": "plans", "From": "swpk12_available_funds", "sql_on": "${funding.to_proposal_id} = ${available_funds.proposal_id} and ${plans.proposal_id}= ${available_funds.proposal_id}", "fields": "all"}, {"To": "plans", "From": "all_lead_institution", "sql_on": "${plans.proposal_id} = ${lead_agency.proposal_id}", "fields": "all"}, {"To": "plans", "From": "all_project_lead", "sql_on": "${lead_contact.proposal_id} = ${plans.proposal_id}", "fields": "all"}, {"To": "plans", "From": "swpk12_agency_contributions", "sql_on": "${partners.proposal_id} = ${plans.proposal_id}", "fields": "all"}, {"To": "plans", "From": "swpk12_plan_budget_items", "sql_on": "${plan_budget.proposal_id} = ${partners.proposal_id} and ${plan_budget.institution_id} = ${partners.institution_id}", "fields": "all"}, {"To": "plans", "From": "all_durations", "sql_on": "${all_durations.duration_id} = ${plan_budget.duration_id}", "fields": []}, {"To": "plans", "From": "all_years", "sql_on": "${all_years.year_id} = ${all_durations.year_id}", "fields": "all"}, {"To": "plans", "From": "swpk12_plan_forecasts", "sql_on": "${forecasts.proposal_id} = ${plan_budget.proposal_id} and ${forecasts.duration_id} = ${plan_budget.duration_id}", "fields": "all"}, {"To": "plans", "From": "swpk12_plan_activities", "sql_on": "${activities.effort_area_id} = ${plan_budget.activity_effort_area_id}", "fields": "all"}, {"To": "plans", "From": "swpk12_activity_metrics", "sql_on": "${activity_metrics.effort_area_id} = ${activities.effort_area_id}", "fields": "all"}, {"To": "plans", "From": "swpk12_proposal_attributes", "sql_on": "${swpk12_application_plans.application_id} = ${app_attributes.proposal_id}", "fields": "all"}, {"To": "plans", "From": "swpk12_impacted_groups", "sql_on": "${swpk12_proposal_attributes.attributes_ids} = ${swpk12_impacted_groups.impacted_group_id} and ${swpk12_proposal_attributes.attribute_name} = 'impacted_groups'", "fields": "all"}, {"To": "plans", "From": "swpk12_population_focus", "sql_on": "${swpk12_proposal_attributes.attribute_name} = 'pf_sectors' and ${swpk12_proposal_attributes.attributes_ids} = ${swpk12_population_focus.sectors_id}", "fields": "all"}, {"To": "plans", "From": "swpk12_target_industries", "sql_on": "${application_sectors.sector_id} = ${app_attributes.attributes_ids}", "fields": "all"}, {"To": "plans", "From": "swpk12_pathway_sectors", "sql_on": "${application_pathways.proposal_id} = ${swpk12_application_plans.application_id}", "fields": "all"}, {"To": "plans", "From": "swpk12_descriptions_of_need", "sql_on": "${application_needs.proposal_id} = ${swpk12_application_plans.application_id}", "fields": "all"}, {"To": "plans", "From": "swpk12_application_plans", "sql_on": "${swpk12_application_plans.proposal_id} = ${plans.proposal_id}", "fields": "all"}, {"To": "plans", "From": "swpk12_funding_status", "sql_on": "${funding_status.proposal_id} = ${swpk12_application_plans.application_id}", "fields": ["funding_status.Requested_Amount", "funding_status.requested_amount"]}, {"To": "swp_l", "From": "swp_l_accountability", "sql_on": "NA", "fields": "NA"}, {"To": "swp_l", "From": "financial_reporting", "sql_on": "NA", "fields": "NA"}, {"To": "swp_l", "From": "swp_l_allocations", "sql_on": "NA", "fields": "NA"}, {"To": "swp_l", "From": "project_details", "sql_on": "NA", "fields": "NA"}, {"To": "swp_l_accountability", "From": "swp_l_accountability", "sql_on": "NA", "fields": "all"}, {"To": "financial_reporting", "From": "proposals_institutions_funds_durations_object_codes", "sql_on": "NA", "fields": "all"}, {"To": "financial_reporting", "From": "all_proposals", "sql_on": "${proposals.proposal_id} = ${financial_reporting.proposal_id} and ${financial_reporting.fund_id} = 1\n    and ${financial_reporting.year_id} >= ${proposals.start_year_id} and ${financial_reporting.year_id} <= ${proposals.end_year_id}", "fields": "all"}, {"To": "financial_reporting", "From": "all_project_lead", "sql_on": "${project_lead.proposal_id} = ${financial_reporting.proposal_id}", "fields": "all"}, {"To": "financial_reporting", "From": "all_institutions_dt", "sql_on": "${institutions.institution_id} = ${financial_reporting.institution_id} and ${financial_reporting.fund_id} = 1", "fields": "all"}, {"To": "financial_reporting", "From": "all_allocations", "sql_on": "${all_allocations.to_institution_id} = ${institutions.region_id} and ${all_allocations.allocation_year} = ${financial_reporting.year_id} and ${all_allocations.fund_id} = 1", "fields": ["all_allocations.Allocations"]}, {"To": "financial_reporting", "From": "swp_certifying_authority", "sql_on": "${certifying_authority.institution_id} = ${financial_reporting.institution_id}", "fields": "all"}, {"To": "financial_reporting", "From": "swp_annual_report_status", "sql_on": "${annual_report.proposal_id} = ${financial_reporting.proposal_id} and ${annual_report.year_id} = ${financial_reporting.year_id}", "fields": "all"}, {"To": "financial_reporting", "From": "all_years", "sql_on": "${years.year_id} = ${financial_reporting.year_id} and ${financial_reporting.fund_id} = 1", "fields": "all"}, {"To": "financial_reporting", "From": "all_fiscal_reports_lines", "sql_on": "${expenditures.proposals_institutions_id} = ${financial_reporting.proposals_institutions_id}\n      and ${expenditures.duration_id} = ${financial_reporting.duration_id}\n      and ${expenditures.object_code_id} = ${financial_reporting.object_code_id}\n      and ${financial_reporting.fund_id} = 1", "fields": "all"}, {"To": "financial_reporting", "From": "fiscal_report_status", "sql_on": "${fiscal_report_status.proposals_institutions_id} = ${financial_reporting.proposals_institutions_id} and ${fiscal_report_status.year_id} = ${financial_reporting.year_id}", "fields": "all"}, {"To": "financial_reporting", "From": "budgets_unpivoted", "sql_on": "${budgets.proposals_institutions_id} = ${financial_reporting.proposals_institutions_id}\n      and ${budgets.duration_id} = ${financial_reporting.duration_id}\n      and ${budgets.object_code_id} = ${financial_reporting.object_code_id}\n      and ${financial_reporting.fund_id} = 1", "fields": "all"}, {"To": "financial_reporting", "From": "swp_project_budget", "sql_on": "${project_budget.proposals_institutions_id} = ${financial_reporting.proposals_institutions_id} and ${project_budget.object_code_id} = ${financial_reporting.object_code_id}", "fields": "all"}, {"To": "project_details", "From": "ALL_proposals_institutions_names_funds", "sql_on": "NA", "fields": "all"}, {"To": "project_details", "From": "all_project_lead", "sql_on": "${all_project_lead.proposal_id} = ${project_details.proposal_id}", "fields": "all"}, {"To": "project_details", "From": "all_lead_institution", "sql_on": "${lead_agency.proposal_id} = ${project_details.proposal_id}", "fields": ["lead_agency.lead_agency"]}, {"To": "project_details", "From": "dw_lmi", "sql_on": "${dw_lmi.proposals_institutions_id} = ${project_details.proposals_institutions_id}", "fields": "all"}, {"To": "project_details", "From": "proposals_sectors", "sql_on": "${proposals_sectors.proposal_id} = ${project_details.proposal_id}", "fields": "all"}, {"To": "project_details", "From": "states", "sql_on": "${project_details.state_id} = ${states.state_id}", "fields": ["states.status"]}, {"To": "swp_r", "From": "swp_r_accountability", "sql_on": "NA", "fields": "NA"}, {"To": "swp_r", "From": "financial_reporting", "sql_on": "NA", "fields": "NA"}, {"To": "swp_r", "From": "project_details", "sql_on": "NA", "fields": "NA"}, {"To": "swp_r", "From": "swp_r_allocations", "sql_on": "NA", "fields": "NA"}, {"To": "swp_r_accountability", "From": "swp_r_accountability", "sql_on": "NA", "fields": "all"}, {"To": "swp_r_allocations", "From": "swp_r_allocations", "sql_on": "NA", "fields": "all"}]}